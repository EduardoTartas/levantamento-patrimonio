# Plano de Teste para Model `Campus` (Milestone 2 - Sprint 3)

| Funcionalidade                      | Comportamento Esperado                                                                 | Verificações                                                                                   | Critérios de Aceite                                                                                           |
|------------------------------------|----------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------|
| **Criação de Campus**              |                                                                                        |                                                                                               |                                                                                                              |
| Campos obrigatórios                | Um campus só pode ser cadastrado se possuir `nome` e `cidade`.                         | Tentar salvar campus sem `nome` ou sem `cidade` (individualmente e com strings vazias).       | A operação deve falhar com erro de validação (`Path \`nome\` is required`, `Path \`cidade\` is required`).    |
| Cadastro válido                    | Um campus com `nome` e `cidade` válidos deve ser salvo com sucesso.                    | Inserir campus com `nome: "Campus IFRO"` e `cidade: "Vilhena"`.                              | O campus é salvo e retornado com `_id`, `nome`, `cidade` e `status` como `true`.                            |
| Valor padrão de status             | Ao cadastrar um campus sem informar o campo `status`, o valor padrão deve ser `true`.  | Cadastrar campus omitindo o campo `status`.                                                   | O campo `status` do campus salvo deve ser `true`.                                                            |
| Validação de tipos                 | Os campos devem aceitar apenas os tipos definidos no schema (ex: `nome` como `String`). | Tentar salvar campus com `nome: 1234` e `cidade: true`.                                       | A operação deve falhar com erro de cast (`Cast to String failed`).                                          |
| Registro de timestamps             | O sistema deve registrar automaticamente `createdAt` e `updatedAt`.                    | Cadastrar um campus e verificar os campos `createdAt` e `updatedAt`.                         | Ambos os campos existem, são instâncias de `Date` e foram preenchidos corretamente.                          |
| **Leitura de Campus**             |                                                                                        |                                                                                               |                                                                                                              |
| Listar todos os campus             | O sistema deve retornar todos os registros de campus existentes.                       | Após cadastrar múltiplos campus, usar `Campus.find()` para buscar todos.                     | A consulta retorna um array com o número correto de registros.                                              |
| Paginação                          | O sistema deve suportar paginação na listagem de campus.                               | Inserir 15 campus e paginar com `limit: 5, page: 2`.                                           | O resultado contém 5 registros, `page` igual a 2, `totalDocs` = 15, `totalPages` = 3.                         |
| **Atualização de Campus**         |                                                                                        |                                                                                               |                                                                                                              |
| Atualização de campos              | Deve ser possível atualizar campos como `nome` e `cidade`.                             | Buscar um campus, atualizar `nome` e `cidade` e salvar.                                      | O campus atualizado reflete as alterações e `updatedAt` é mais recente.                                     |
| Validação de campos obrigatórios   | Campos obrigatórios não podem ser atualizados para valores vazios.                     | Atualizar `nome` para `""` (string vazia).                                                    | A operação falha com erro de validação (`Path \`nome\` is required`).                                       |
| **Remoção de Campus**             |                                                                                        |                                                                                               |                                                                                                              |
| Remoção de campus existente        | Um campus existente pode ser removido do sistema.                                      | Cadastrar um campus, depois usar `Campus.deleteOne()` para removê-lo.                        | A operação retorna `deletedCount: 1` e o campus não é mais encontrado com `findById`.                        |


# Plano de Teste Controller - Campus (Milestone 2 - Sprint 3)

| Funcionalidade               | Comportamento Esperado                                                                                             | Verificações                                                                                                                           | Critérios de Aceite                                                                                                                                                                                       |
|-----------------------------|---------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Listar Campus**           |                                                                                                                     |                                                                                                                                        |                                                                                                                                                                                                           |
| Listar todos (sem ID/query) | O controller deve chamar o serviço para listar todos os campus e retornar uma resposta de sucesso.                   | Chamar `listar()` sem `id` e sem `query`. Mockar `CampusService.listar` para retornar uma lista de campus.                            | `CampusIdSchema.parse` não é chamado. `CampusQuerySchema.parseAsync` é chamado com objeto vazio. `CampusService.listar` é chamado. `CommonResponse.success` é chamado com a lista de campus.              |
| Listar campus por ID        | O controller deve validar o ID, chamar o serviço para buscar um campus específico e retornar uma resposta de sucesso. | Chamar `listar()` com um `id` válido. Mockar `CampusIdSchema.parse` e `CampusService.listar`.                                          | `CampusIdSchema.parse` é chamado com o ID. `CampusService.listar` é chamado. `CommonResponse.success` é chamado com o campus encontrado.                                                                |
| Listar campus com query     | O controller deve validar a query, chamar o serviço e retornar uma resposta com os campus filtrados.                 | Chamar `listar()` com `query` válida. Mockar `CampusQuerySchema.parseAsync` e `CampusService.listar`.                                 | `CampusQuerySchema.parseAsync` é chamado com a query. `CampusService.listar` é chamado. `CommonResponse.success` é chamado com os campus filtrados.                                                     |
| Falha na validação de ID    | Se o ID for inválido, o controller deve lançar o erro.                                                              | Chamar `listar()` com `id` inválido. Mockar `CampusIdSchema.parse` para lançar erro.                                                  | O método `listar` lança erro. `CampusService.listar` não é chamado.                                                                                                                                      |
| Falha na validação de query | Se a query for inválida, o controller deve lançar o erro.                                                           | Chamar `listar()` com `query` inválida. Mockar `CampusQuerySchema.parseAsync` para lançar erro.                                       | O método `listar` lança erro. `CampusService.listar` não é chamado.                                                                                                                                      |
| Erro no serviço (Listar)    | Se o serviço lançar erro, o controller deve propagar o erro.                                                        | Mockar `CampusService.listar` para lançar erro.                                                                                        | O método `listar` do controller propaga o erro do serviço.                                                                                                                                               |
| **Criar Campus**            |                                                                                                                     |                                                                                                                                        |                                                                                                                                                                                                           |
| Criação bem-sucedida        | O controller deve validar os dados, chamar o serviço para criar e retornar uma resposta de sucesso.                  | Chamar `criar()` com `body` válido. Mockar `CampusSchema.parse` e `CampusService.criar`.                                               | `CampusSchema.parse` é chamado com os dados. `CampusService.criar` é chamado. `CommonResponse.created` é chamado com o campus criado.                                                                  |
| Falha na validação (Criar)  | Se os dados forem inválidos, o controller deve lançar erro.                                                         | Chamar `criar()` com `body` inválido. Mockar `CampusSchema.parse` para lançar erro.                                                   | O método `criar` lança erro. `CampusService.criar` não é chamado.                                                                                                                                         |
| Erro no serviço (Criar)     | Se o serviço lançar erro, o controller deve propagar o erro.                                                        | Chamar `criar()` com dados válidos. Mockar `CampusService.criar` para lançar erro.                                                    | O método `criar` propaga o erro do serviço.                                                                                                                                                               |
| **Atualizar Campus**        |                                                                                                                     |                                                                                                                                        |                                                                                                                                                                                                           |
| Atualização bem-sucedida    | O controller deve validar ID e dados, chamar o serviço e retornar sucesso com mensagem.                             | Chamar `atualizar()` com `id` e `body` válidos. Mockar `CampusIdSchema.parse`, `CampusUpdateSchema.parse`, `CampusService.atualizar`. | Ambos os schemas são chamados. `CampusService.atualizar` é chamado com ID e dados. `CommonResponse.success` é chamado com campus atualizado e mensagem específica.                                     |
| Falha na validação de ID    | Se o ID for inválido, o controller deve lançar erro.                                                                | Chamar `atualizar()` com `id` inválido. Mockar `CampusIdSchema.parse` para lançar erro.                                               | O método `atualizar` lança erro. `CampusService.atualizar` não é chamado.                                                                                                                                |
| Falha na validação (Att)    | Se os dados forem inválidos, o controller deve lançar erro.                                                         | Chamar `atualizar()` com `body` inválido. Mockar `CampusUpdateSchema.parse` para lançar erro.                                         | O método `atualizar` lança erro. `CampusService.atualizar` não é chamado.                                                                                                                                |
| Erro no serviço (Att)       | Se o serviço lançar erro, o controller deve propagar o erro.                                                        | Chamar `atualizar()` com dados válidos. Mockar `CampusService.atualizar` para lançar erro.                                            | O método `atualizar` propaga o erro do serviço.                                                                                                                                                          |
| **Deletar Campus**          |                                                                                                                     |                                                                                                                                        |                                                                                                                                                                                                           |
| Deleção bem-sucedida        | O controller deve validar o ID, chamar o serviço para deletar e retornar mensagem de sucesso.                        | Chamar `deletar()` com `id` válido. Mockar `CampusIdSchema.parse` e `CampusService.deletar`.                                           | `CampusIdSchema.parse` é chamado. `CampusService.deletar` é chamado. `CommonResponse.success` é chamado com resposta e mensagem de sucesso.                                                            |
| Falha na validação de ID    | Se o ID for inválido, o controller deve lançar erro.                                                                | Chamar `deletar()` com `id` inválido. Mockar `CampusIdSchema.parse` para lançar erro.                                                 | O método `deletar` lança erro. `CampusService.deletar` não é chamado.                                                                                                                                    |
| Erro no serviço (Del)       | Se o serviço lançar erro, o controller deve propagar o erro.                                                        | Chamar `deletar()` com `id` válido. Mockar `CampusService.deletar` para lançar erro.                                                  | O método `deletar` propaga o erro do serviço.                                                                                                                                                             |


# Plano de Teste para `CampusService` (Milestone 2 - Sprint 3)

| Método              | Comportamento Esperado                                                                 | Verificações                                                                                   | Critérios de Aceite                                                                                           |
|---------------------|----------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------|
| **listar()**        | Retornar uma lista com todos os campus cadastrados.                                    | Simular retorno de `[ { id: 1, nome: 'IFRO', cidade: 'Vilhena' } ]`.                          | O método deve retornar exatamente o array mockado.                                                            |
| **criar()**         |                                                                                         |                                                                                               |                                                                                                               |
| Campus não duplicado | Criar um novo campus quando não houver outro com o mesmo nome e cidade.               | Simular `buscarPorNome` retornando `null` e `criar` retornando `{ id: 1, ...dados }`.         | O método deve retornar `{ id: 1, nome: 'IFRO', cidade: 'Vilhena' }`.                                         |
| Campus duplicado     | Lançar um `CustomError` ao tentar criar campus já existente.                          | Simular `buscarPorNome` retornando um campus existente.                                       | O método deve lançar erro do tipo `CustomError`.                                                              |
| **atualizar()**     |                                                                                         |                                                                                               |                                                                                                               |
| Campus válido        | Atualizar os dados de um campus existente.                                            | Simular `buscarPorId`, `buscarPorNome` e `atualizar`.                                         | O resultado deve conter os dados atualizados e o mesmo `id`.                                                 |
| **deletar()**       |                                                                                         |                                                                                               |                                                                                                               |
| Sem usuários         | Deletar um campus quando não houver usuários associados.                              | Simular `buscarPorId`, `verificarUsuariosAssociados` retornando `false` e `deletar` retornando `true`. | O método deve retornar `true`.                                                                                |
| Com usuários         | Lançar `CustomError` se houver usuários associados ao campus.                         | Simular `verificarUsuariosAssociados` retornando `true`.                                     | O método deve lançar erro do tipo `CustomError`.                                                              |

# Plano de Teste para `CampusRepository` (Milestone 2 - Sprint 3)

| Método                           | Cenário                                         | Comportamento Esperado                                                                               | Verificações                                                                                                         | Critérios de Aceite                                                                                      |
|----------------------------------|--------------------------------------------------|--------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------|
| **constructor()**                | Falta o método `paginate` no modelo Campus      | Lançar erro informando que `Campus` deve conter o método `paginate`.                                  | Remover `Campus.paginate` antes de instanciar o repositório.                                                        | Deve lançar erro com mensagem similar a "`Campus model must include the paginate method`".              |
| **buscarPorNome()**              | Somente nome informado                          | Buscar campus pelo nome.                                                                              | Simular `Campus.findOne` e verificar chamada com `{ nome: 'UFRO' }`.                                                | Deve retornar o resultado simulado de `findOne`.                                                         |
|                                  | Nome e cidade informados                        | Buscar campus por nome e cidade.                                                                      | Simular `Campus.findOne` e verificar chamada com `{ nome: 'UFRO', cidade: 'Vilhena' }`.                            | Deve retornar o campus correspondente.                                                                  |
|                                  | Nome e idDiferente                              | Buscar campus com nome, exceto um `id` específico.                                                    | Simular `Campus.findOne` e verificar chamada com `{ nome: 'UFRO', _id: { $ne: '123' } }`.                          | Deve retornar o campus correspondente.                                                                  |
| **buscarPorId()**                | Campus encontrado                               | Retornar o campus correspondente ao ID.                                                               | Simular `Campus.findById` retornando um valor.                                                                     | O retorno deve ser igual ao mock de `findById`.                                                          |
|                                  | Campus não encontrado                           | Lançar `CustomError`.                                                                                 | Simular `Campus.findById` retornando `null`.                                                                       | Deve lançar erro do tipo `CustomError`.                                                                  |
| **listar()**                     | ID informado e campus encontrado                | Retornar os dados do campus encontrado.                                                              | Simular `Campus.findById` retornando um campus.                                                                    | O resultado deve ser igual ao mock de `findById`.                                                        |
|                                  | ID informado e campus não encontrado            | Lançar `CustomError`.                                                                                 | Simular `Campus.findById` retornando `null`.                                                                       | Deve lançar erro do tipo `CustomError`.                                                                  |
|                                  | Sem ID - filtros válidos                        | Utilizar `CampusFilterBuilder` e `paginate` para retornar campus.                                     | Simular `Campus.paginate` com filtros construídos pelo builder.                                                    | O resultado deve ser igual ao mock de `paginate`.                                                        |
|                                  | Filtro mal implementado (build inválido)        | Lançar `CustomError` caso builder seja inválido.                                                      | Simular `CampusFilterBuilder.build` sendo `null`.                                                                  | Deve lançar erro do tipo `CustomError`.                                                                  |
| **criar()**                      | Campus válido                                   | Criar e salvar um novo campus.                                                                        | Mock de `Campus.save` retornando o campus salvo.                                                                   | Deve retornar os dados do campus salvo.                                                                  |
| **atualizar()**                  | Campus existente                                | Atualizar dados do campus.                                                                            | Simular `Campus.findByIdAndUpdate` retornando o campus atualizado.                                                 | O retorno deve conter os dados atualizados.                                                              |
|                                  | Campus inexistente                              | Lançar `CustomError`.                                                                                 | Simular `Campus.findByIdAndUpdate` retornando `null`.                                                               | Deve lançar erro do tipo `CustomError`.                                                                  |
| **deletar()**                    | Campus existente                                | Deletar campus e retornar dados.                                                                      | Simular `Campus.findByIdAndDelete` retornando o campus deletado.                                                   | Deve retornar o campus deletado.                                                                         |
|                                  | Campus inexistente                              | Lançar `CustomError`.                                                                                 | Simular `Campus.findByIdAndDelete` retornando `null`.                                                               | Deve lançar erro do tipo `CustomError`.                                                                  |
| **verificarUsuariosAssociados()** | Verificar associação de usuários ao campus      | Verificar se algum `Usuario` está associado ao campus.                                                | Simular `Usuario.findOne` com filtro `{ campus: 'campusId' }`.                                                     | Deve retornar o resultado simulado de `findOne`, podendo ser `null` ou um usuário.                      |

# Plano de Teste ENDPOINT (Sprint X)

*(A ser preenchido)*