
# Plano de Teste para Model (Milestone 2 - Sprint 3) 

| Funcionalidade                       | Comportamento Esperado                                                                                                | Verificações                                                                                                     | Critérios de Aceite                                                                                                                               |
| :------------------------------------ | :-------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------- |
| **Criação de Inventário** |                                                                                                                       |                                                                                                                  |                                                                                                                                                 |
| Campos obrigatórios                   | Um inventário só pode ser cadastrado se possuir `campus`, `nome` e `data`.                                             | Tentar salvar inventário sem `campus`, `nome` ou `data` (individualmente e com strings/valores nulos/inválidos). | A operação deve falhar com erro de validação indicando que o respectivo campo é obrigatório (`Path \`...\` is required`).                       |
| Cadastro válido                       | Um inventário com todos os campos obrigatórios (`campus`, `nome`, `data`) válidos deve ser salvo com sucesso.         | Inserir um inventário com todos os campos obrigatórios preenchidos corretamente.                                   | O inventário é salvo e retornado com `_id`, `createdAt`, `updatedAt` e os campos fornecidos corretamente.                                       |
| Valor padrão de `status`             | Ao cadastrar um inventário sem informar o campo `status`, o valor padrão no documento salvo deve ser `true`.            | Cadastrar um inventário sem incluir o campo `status` nos dados de entrada.                                       | O campo `status` do inventário salvo deve ser `true`.                                                                                             |
| Validação de Formato do `campus`      | O campo `campus` deve ser um ObjectId válido para ser salvo.                                                          | Tentar salvar um inventário fornecendo uma string que não é um formato ObjectId válido para o campo `campus`.      | A operação deve falhar com um erro de cast para ObjectId (`Cast to ObjectId failed for value "..." at path "campus"`).                             |
| Validação de Formato da `data`        | O campo `data` deve ser uma data válida para ser salvo.                                                              | Tentar salvar um inventário fornecendo uma string/valor inválido para o campo `data`.                             | A operação deve falhar com um erro de cast para Date (`Cast to date failed for value "..." at path "data"`).                                    |
| Indexação do campo `nome`             | O campo `nome` deve ser indexado conforme definido no schema (para otimização de busca, não implica unicidade aqui). | (Teste mais complexo, geralmente verificado por análise de `getIndexes()` ou comportamento em queries específicas) | O índice para o campo `nome` existe na coleção. (Pode ser verificado inspecionando os índices da coleção no banco de dados).                     |
| Registro de `timestamps`              | O sistema deve registrar automaticamente as datas de criação (`createdAt`) e atualização (`updatedAt`).                   | Cadastrar um inventário e verificar os campos `createdAt` e `updatedAt`.                                           | Os campos `createdAt` e `updatedAt` existem, são instâncias de `Date` e são preenchidos corretamente.                                           |
| Ausência de `versionKey`              | O campo `__v` (versionKey) não deve estar presente nos documentos salvos.                                            | Cadastrar um inventário e verificar a ausência do campo `__v`.                                                    | O campo `__v` não está presente no documento do inventário retornado.                                                                           |
| **Leitura de Inventários** |                                                                                                                       |                                                                                                                  |                                                                                                                                                 |
| Listar todos os inventários          | O sistema deve ser capaz de retornar todos os inventários cadastrados.                                                 | Após cadastrar múltiplos inventários, fazer `Inventario.find()` para buscar todos.                               | A consulta retorna um array contendo o número correto de inventários cadastrados.                                                                 |
| Paginação (mongoose-paginate-v2)   | O método `paginate` deve funcionar conforme a documentação do plugin.                                                | Realizar uma consulta usando `Inventario.paginate({}, { page: 1, limit: 5 })`.                                   | A consulta retorna um objeto com as propriedades esperadas (`docs`, `totalDocs`, `limit`, `page`, `totalPages`, etc.) e os dados corretos.      |
| **Atualização de Inventário** |                                                                                                                       |                                                                                                                  |                                                                                                                                                 |
| Atualização de campos genéricos       | Deve ser possível atualizar informações de um inventário existente (ex: `nome`, `status`, `data`, `campus`).           | Buscar um inventário, alterar seu `nome`, `status` e `data`, e salvar.                                            | O inventário recuperado após a atualização reflete as alterações e o campo `updatedAt` é mais recente que `createdAt` e o `updatedAt` anterior. |
| Validação de campos obrigatórios (Update) | Campos obrigatórios (`nome`, `data`, `campus`) não podem ser atualizados para valores nulos ou inválidos.              | Tentar atualizar o `nome` de um inventário para `null` ou string vazia. Tentar atualizar `data` para `null`.     | A operação de salvamento deve falhar com erro de validação (`Path \`...\` is required` ou erro de cast).                                    |
| Atualização de `status`               | Deve ser possível atualizar o campo `status` para `false` ou `true`.                                                   | Atualizar o campo `status` de um inventário para `false`, e depois para `true`.                                   | O campo `status` é alterado corretamente no banco de dados.                                                                                       |
| **Remoção de Inventário** |                                                                                                                       |                                                                                                                  |                                                                                                                                                 |
| Remoção de inventário existente      | Um inventário existente deve poder ser removido do sistema.                                                          | Cadastrar um inventário, depois usar `Inventario.deleteOne()` ou `findByIdAndDelete()` para removê-lo.             | A operação de remoção é bem-sucedida (`deletedCount` é 1) e o inventário não é mais encontrado por `findById`.                                |       |




# Plano de Teste Controller (Milestone 2 - Sprint 3)

| Funcionalidade                | Comportamento Esperado                                                                                                   | Verificações                                                                                                                                     | Critérios de Aceite                                                                                                                                                                                                      |
| :---------------------------- | :----------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Listar Inventários** |                                                                                                                          |                                                                                                                                                  |                                                                                                                                                                                                                          |
| Listar todos (sem ID/query)   | O controller deve chamar o serviço para listar todos os inventários e retornar uma resposta de sucesso.                    | Chamar `listar()` sem `id` nos parâmetros e com `query` vazia. Mockar `InventarioService.listar` para retornar uma lista de inventários.         | `InventarioIdSchema.parse` não é chamado. `InventarioQuerySchema.parseAsync` não é chamado (devido à verificação `Object.keys(query).length !== 0`). `InventarioService.listar` é chamado. `CommonResponse.success` é chamado com a lista de inventários. |
| Listar inventário por ID      | O controller deve validar o ID, chamar o serviço para buscar um inventário específico e retornar uma resposta de sucesso. | Chamar `listar()` com um `id` válido nos parâmetros. Mockar `InventarioIdSchema.parse` (ou deixar executar) e `InventarioService.listar` para sucesso. | `InventarioIdSchema.parse` é chamado com o ID. `InventarioService.listar` é chamado. `CommonResponse.success` é chamado com o inventário encontrado.                                                                     |
| Listar inventários com query  | O controller deve validar a query, chamar o serviço para buscar inventários filtrados e retornar uma resposta de sucesso.  | Chamar `listar()` com parâmetros de `query` válidos. Mockar `InventarioQuerySchema.parseAsync` (ou deixar executar) e `InventarioService.listar` para sucesso. | `InventarioQuerySchema.parseAsync` é chamado com a query. `InventarioService.listar` é chamado. `CommonResponse.success` é chamado com a lista de inventários filtrados.                                                        |
| Falha na validação de ID (Listar) | Se a validação do ID via Zod (`InventarioIdSchema.parse`) falhar, o controller deve propagar o erro.                       | Chamar `listar()` com um `id` inválido. Mockar `InventarioIdSchema.parse` para lançar um erro (ou testar o Zod real).                          | O método `listar` do controller lança o erro. `InventarioService.listar` não é chamado.                                                                                                                                |
| Falha na validação de query   | Se a validação da query via Zod (`InventarioQuerySchema.parseAsync`) falhar, o controller deve propagar o erro.              | Chamar `listar()` com uma `query` inválida. Mockar `InventarioQuerySchema.parseAsync` para lançar um erro (ou testar o Zod real).                 | O método `listar` do controller lança o erro. `InventarioService.listar` não é chamado.                                                                                                                                |
| Erro no serviço (Listar)      | Se o método `listar` do serviço lançar um erro, o controller deve propagar esse erro.                                    | Mockar `InventarioService.listar` para rejeitar com um erro.                                                                                     | O método `listar` do controller lança o erro vindo do serviço.                                                                                                                                                         |
| **Criar Inventário** |                                                                                                                          |                                                                                                                                                  |                                                                                                                                                                                                                          |
| Criação bem-sucedida          | O controller deve validar os dados do corpo da requisição, chamar o serviço para criar o inventário e retornar sucesso.    | Chamar `criar()` com dados válidos no `body`. Mockar `InventarioSchema.parse` (ou deixar executar) e `InventarioService.criar` (retornando um objeto com método `toObject`). | `InventarioSchema.parse` é chamado com os dados do corpo. `InventarioService.criar` é chamado com os dados parseados. O método `toObject()` do resultado do serviço é chamado. `CommonResponse.created` é chamado com os dados do inventário. |
| Falha na validação (Criar)    | Se a validação dos dados do corpo da requisição via Zod (`InventarioSchema.parse`) falhar, o controller deve propagar o erro. | Chamar `criar()` com dados inválidos no `body`. Mockar `InventarioSchema.parse` para lançar um erro (ou testar o Zod real).                      | O método `criar` do controller lança o erro. `InventarioService.criar` não é chamado.                                                                                                                                  |
| Erro no serviço (Criar)       | Se o método `criar` do serviço lançar um erro, o controller deve propagar esse erro.                                     | Chamar `criar()` com dados válidos. Mockar `InventarioService.criar` para rejeitar com um erro.                                                  | O método `criar` do controller lança o erro vindo do serviço.                                                                                                                                                          |
| **Atualizar Inventário** |                                                                                                                          |                                                                                                                                                  |                                                                                                                                                                                                                          |
| Atualização bem-sucedida      | O controller deve validar o ID e os dados do corpo, chamar o serviço para atualizar e retornar sucesso com mensagem.       | Chamar `atualizar()` com `id` e `body` válidos. Mockar `InventarioIdSchema.parse`, `InventarioUpdateSchema.parse` (ou deixar executar) e `InventarioService.atualizar`. | `InventarioIdSchema.parse` e `InventarioUpdateSchema.parse` são chamados. `InventarioService.atualizar` é chamado com ID e dados. `CommonResponse.success` é chamado com inventário atualizado e mensagem "Inventario atualizado com sucesso.". |
| Falha na validação de ID (Att) | Se a validação do ID via Zod (`InventarioIdSchema.parse`) falhar, o controller deve propagar o erro.                       | Chamar `atualizar()` com um `id` inválido. Mockar `InventarioIdSchema.parse` para lançar um erro (ou testar o Zod real).                      | O método `atualizar` do controller lança o erro. `InventarioService.atualizar` não é chamado.                                                                                                                          |
| Falha na validação (Att)      | Se a validação dos dados do corpo via Zod (`InventarioUpdateSchema.parse`) falhar, o controller deve propagar o erro.       | Chamar `atualizar()` com `body` inválido. Mockar `InventarioUpdateSchema.parse` para lançar um erro (ou testar o Zod real).                  | O método `atualizar` do controller lança o erro. `InventarioService.atualizar` não é chamado.                                                                                                                          |
| Erro no serviço (Att)         | Se o método `atualizar` do serviço lançar um erro, o controller deve propagar esse erro.                                 | Chamar `atualizar()` com dados válidos. Mockar `InventarioService.atualizar` para rejeitar com um erro.                                        | O método `atualizar` do controller lança o erro vindo do serviço.                                                                                                                                                      |
| **Deletar Inventário** |                                                                                                                          |                                                                                                                                                  |                                                                                                                                                                                                                          |
| Deleção bem-sucedida          | O controller deve validar o ID, chamar o serviço para deletar o inventário e retornar sucesso com mensagem.                | Chamar `deletar()` com um `id` válido. Mockar `InventarioIdSchema.parse` (ou deixar executar) e `InventarioService.deletar`.                      | `InventarioIdSchema.parse` é chamado com o ID. `InventarioService.deletar` é chamado com o ID. `CommonResponse.success` é chamado com a resposta do serviço e mensagem "Inventario excluído com sucesso.".                |
| Falha na validação de ID (Del)| Se a validação do ID via Zod (`InventarioIdSchema.parse`) falhar, o controller deve propagar o erro.                       | Chamar `deletar()` com um `id` inválido. Mockar `InventarioIdSchema.parse` para lançar um erro (ou testar o Zod real).                        | O método `deletar` do controller lança o erro. `InventarioService.deletar` não é chamado.                                                                                                                              |
| Erro no serviço (Del)         | Se o método `deletar` do serviço lançar um erro, o controller deve propagar esse erro.                                   | Chamar `deletar()` com `id` válido. Mockar `InventarioService.deletar` para rejeitar com um erro.                                               | O método `deletar` do controller lança o erro vindo do serviço.                                                                                                                                                       |

# Plano de Teste Service (Milestone 2 - Sprint 3)

| Funcionalidade                                  | Comportamento Esperado                                                                                                                               | Verificações                                                                                                                                                                                                      | Critérios de Aceite                                                                                                                                                                                                                                                           |
| :---------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Listar Inventários** |                                                                                                                                                      |                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                             |
| Listar inventários (sucesso)                    | Deve chamar `repository.listar` com os parâmetros corretos (o objeto `req` inteiro) e retornar os dados.                                                | Chamar `service.listar(mockReq)`. Mockar `repository.listar` para retornar `mockResponseData`.                                                                                                                  | `repository.listar` é chamado com `mockReq`. O resultado é igual a `mockResponseData`.                                                                                                                                                                                        |
| Listar inventários (erro no repositório)        | Deve propagar erros originados no `repository.listar`.                                                                                                 | Chamar `service.listar(mockReq)`. Mockar `repository.listar` para rejeitar com um erro.                                                                                                                           | A chamada a `service.listar` rejeita com o mesmo erro lançado pelo repositório.                                                                                                                                                                                             |
| **Criar Inventário** |                                                                                                                                                      |                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                             |
| Criar inventário (sucesso)                      | Deve verificar a existência do campus, e então chamar `repository.criar` com os dados parseados e retornar o inventário criado.                          | Chamar `service.criar(mockParsedData)`. Mockar `campusService.ensureCampExists` para resolver (não lançar erro). Mockar `repository.criar` para retornar `mockInventarioCriado`.                                       | `campusService.ensureCampExists` é chamado com `mockParsedData.campus`. `repository.criar` é chamado com `mockParsedData`. O método retorna `mockInventarioCriado`.                                                                                                          |
| Criar inventário (campus inexistente)           | Deve lançar um erro se `campusService.ensureCampExists` falhar (e.g., campus não existe).                                                               | Chamar `service.criar(mockParsedData)`. Mockar `campusService.ensureCampExists` para rejeitar com `mockCampusError`.                                                                                                | `campusService.ensureCampExists` é chamado. A chamada a `service.criar` rejeita com `mockCampusError`. `repository.criar` não é chamado.                                                                                                                                       |
| Criar inventário (erro no repositório)          | Deve propagar erros do `repository.criar` se `campusService.ensureCampExists` for bem-sucedido.                                                          | Chamar `service.criar(mockParsedData)`. Mockar `campusService.ensureCampExists` para resolver. Mockar `repository.criar` para rejeitar com `mockRepoError`.                                                            | `campusService.ensureCampExists` é chamado. `repository.criar` é chamado. A chamada a `service.criar` rejeita com `mockRepoError`.                                                                                                                                         |
| **Atualizar Inventário** |                                                                                                                                                      |                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                             |
| Atualizar inventário (sucesso, sem campus novo) | Deve garantir que o inventário exista, não verificar campus se não fornecido, e chamar `repository.atualizar`.                                         | Chamar `service.atualizar(mockId, mockUpdateDataSemCampus)`. Mockar `service.ensureInvExists` para resolver com `mockInventarioExistente`. Mockar `repository.atualizar` para retornar `mockInventarioAtualizado`.        | `service.ensureInvExists` é chamado com `mockId`. `campusService.ensureCampExists` NÃO é chamado. `repository.atualizar` é chamado com `mockId` e `mockUpdateDataSemCampus`. Retorna `mockInventarioAtualizado`.                                                              |
| Atualizar inventário (sucesso, com campus novo) | Deve garantir que o inventário exista, verificar o novo campus, e chamar `repository.atualizar`.                                                       | Chamar `service.atualizar(mockId, mockUpdateDataComCampus)`. Mockar `service.ensureInvExists`. Mockar `campusService.ensureCampExists`. Mockar `repository.atualizar`.                                                | `service.ensureInvExists` é chamado. `campusService.ensureCampExists` é chamado com `mockUpdateDataComCampus.campus`. `repository.atualizar` é chamado com `mockId` e `mockUpdateDataComCampus`. Retorna o inventário atualizado.                                         |
| Atualizar inventário (inventário não existe)    | Deve lançar `CustomError` se `ensureInvExists` falhar (inventário não encontrado).                                                                       | Chamar `service.atualizar(mockIdInexistente, mockUpdateData)`. Mockar `service.ensureInvExists` para rejeitar com `mockNotFoundError`.                                                                                 | `service.ensureInvExists` é chamado com `mockIdInexistente`. A chamada a `service.atualizar` rejeita com `mockNotFoundError`. `campusService.ensureCampExists` e `repository.atualizar` não são chamados.                                                               |
| Atualizar inventário (inventário INATIVO)       | Deve falhar ao tentar atualizar um inventário inativo, lançando `CustomError` (`BAD_REQUEST`) originado por `ensureInvExists`. | Chamar `service.atualizar(mockId, mockUpdateDataSemCampus)`. Mockar `repository.buscarPorId` (usado por `ensureInvExists`) para retornar `mockInventarioInativo` (com `status: false`). | `service.ensureInvExists` é chamado. A chamada a `service.atualizar` rejeita com `CustomError` (`statusCode: HttpStatusCodes.BAD_REQUEST.code`, `errorType: "invalidOperation"`, `field: "status"`, `customMessage: "Operação não permitida em inventário inativo."`). `repository.atualizar` NÃO é chamado. |
| Atualizar inventário (campus novo inexistente)  | Deve lançar erro se `parsedData.campus` for fornecido e `campusService.ensureCampExists` falhar.                                                         | Chamar `service.atualizar(mockId, mockUpdateDataComCampus)`. Mockar `service.ensureInvExists`. Mockar `campusService.ensureCampExists` para rejeitar com `mockCampusError`.                                          | `service.ensureInvExists` é chamado. `campusService.ensureCampExists` é chamado. A chamada a `service.atualizar` rejeita com `mockCampusError`. `repository.atualizar` não é chamado.                                                                                   |
| Atualizar inventário (erro no repositório)      | Deve propagar erro do `repository.atualizar` se as verificações anteriores passarem.                                                                   | Chamar `service.atualizar(mockId, mockUpdateData)`. Mockar `service.ensureInvExists`. Mockar `campusService.ensureCampExists` (se aplicável). Mockar `repository.atualizar` para rejeitar com `mockRepoError`.         | `service.ensureInvExists` e `campusService.ensureCampExists` (se aplicável) são chamados. `repository.atualizar` é chamado. A chamada a `service.atualizar` rejeita com `mockRepoError`.                                                                             |
| **Deletar Inventário** |                                                                                                                                                      |                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                             |
| Deletar inventário (sucesso)                    | Deve garantir que o inventário exista e então chamar `repository.deletar`.                                                                             | Chamar `service.deletar(mockId)`. Mockar `service.ensureInvExists` para resolver. Mockar `repository.deletar` para retornar `mockDeleteResponse`.                                                                   | `service.ensureInvExists` é chamado com `mockId`. `repository.deletar` é chamado com `mockId`. O método retorna `mockDeleteResponse`.                                                                                                                                |
| Deletar inventário (inventário não existe)      | Deve lançar `CustomError` se `ensureInvExists` falhar (inventário não encontrado).                                                                       | Chamar `service.deletar(mockIdInexistente)`. Mockar `service.ensureInvExists` para rejeitar com `mockNotFoundError`.                                                                                                  | `service.ensureInvExists` é chamado com `mockIdInexistente`. A chamada a `service.deletar` rejeita com `mockNotFoundError`. `repository.deletar` não é chamado.                                                                                                      |
| Deletar inventário (inventário INATIVO)         | Deve falhar ao tentar deletar um inventário inativo, lançando `CustomError` (`BAD_REQUEST`) originado por `ensureInvExists`. | Chamar `service.deletar(mockId)`. Mockar `repository.buscarPorId` (usado por `ensureInvExists`) para retornar `mockInventarioInativo` (com `status: false`). | `service.ensureInvExists` é chamado com `mockId`. A chamada a `service.deletar` rejeita com `CustomError` (`statusCode: HttpStatusCodes.BAD_REQUEST.code`, `errorType: "invalidOperation"`, `field: "status"`, `customMessage: "Operação não permitida em inventário inativo."`). `repository.deletar` NÃO é chamado. |
| Deletar inventário (erro no repositório)        | Deve propagar erro do `repository.deletar` se `ensureInvExists` for bem-sucedido.                                                                      | Chamar `service.deletar(mockId)`. Mockar `service.ensureInvExists` para resolver. Mockar `repository.deletar` para rejeitar com `mockRepoError`.                                                                  | `service.ensureInvExists` é chamado. `repository.deletar` é chamado. A chamada a `service.deletar` rejeita com `mockRepoError`.                                                                                                                                     |
| **`ensureInvExists` (Auxiliar)** |                                                                                                                                                      |                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                             |
| `ensureInvExists` (inventário existe)           | Deve chamar `repository.buscarPorId` e retornar o inventário se encontrado.                                                                            | Chamar `service.ensureInvExists(mockIdExistente)`. Mockar `repository.buscarPorId` para retornar `mockInventario`.                                                                                                  | `repository.buscarPorId` é chamado com `mockIdExistente`. O método retorna `mockInventario`. Nenhuma exceção é lançada.                                                                                                                                          |
| `ensureInvExists` (inventário não existe)       | Deve chamar `repository.buscarPorId` e lançar `CustomError` com status `NOT_FOUND` se o inventário não for encontrado.                                   | Chamar `service.ensureInvExists(mockIdInexistente)`. Mockar `repository.buscarPorId` para retornar `null`.                                                                                                              | `repository.buscarPorId` é chamado com `mockIdInexistente`. `CustomError` é lançado com `statusCode: HttpStatusCodes.NOT_FOUND.code`, `errorType: "resourceNotFound"`, `field: "Inventário"`, e mensagem `messages.error.resourceNotFound("Inventário")`. |

# Plano de Teste Repository (Milestone 2 - Sprint 3)

| Funcionalidade                                   | Comportamento Esperado                                                                                                                               | Verificações                                                                                                                                                                                                                                                           | Critérios de Aceite                                                                                                                                                                                                                                                                                           |
| :----------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Construtor** |                                                                                                                                                      |                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                 |
| Inicialização válida                             | Deve instanciar o repositório com um modelo `Inventario` que possua o método `paginate`.                                                               | Instanciar `InventarioRepository` com um mock de `InventarioModel` que tenha `paginate`.                                                                                                                                                                                   | Nenhuma exceção é lançada. `this.model` é atribuído corretamente.                                                                                                                                                                                                                                             |
| Inicialização inválida (sem paginate)            | Deve lançar um erro se o modelo `Inventario` injetado não possuir o método `paginate`.                                                                  | Tentar instanciar `InventarioRepository` com um mock de `InventarioModel` sem o método `paginate`.                                                                                                                                                                        | Um erro é lançado com a mensagem "The inventario model must include the paginate method. Ensure mongoose-paginate-v2 is applied.".                                                                                                                                                                  |
| **Buscar Inventário por ID (Repositório)** |                                                                                                                                                      |                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                 |
| Buscar por ID (encontrado, `includeTokens=false`)| Deve buscar um inventário pelo ID. A lógica `includeTokens` não afetará campos padrão de inventário.                                                    | Chamar `repository.buscarPorId(mockInventarioId)`. Mockar `this.model.findById().exec()` (ou apenas `this.model.findById()` se `exec` não for explicitamente usado na cadeia do mock) para resolver com `mockInventarioData`.                                              | `this.model.findById` é chamado com `mockInventarioId`. O `select` para tokens não é chamado (ou não tem efeito prático). O método retorna `mockInventarioData`.                                                                                                                                       |                     
| Buscar por ID (não encontrado)                   | Deve lançar `CustomError` se nenhum inventário for encontrado com o ID fornecido.                                                                      | Chamar `repository.buscarPorId(mockInventarioIdInexistente)`. Mockar `this.model.findById()` para resolver com `null`.                                                                                                                                                     | `this.model.findById` é chamado. `CustomError` é lançado com `statusCode: 404`, `errorType: "resourceNotFound"`, `field: "Inventário"`, e mensagem `messages.error.resourceNotFound("Inventário")`.                                                                                            |
| **Listar Inventários (Repositório)** |                                                                                                                                                      |                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                 |
| Listar (por ID - encontrado)                     | Se um ID é fornecido nos parâmetros (`req.params.id`), deve buscar o inventário por ID com `populate` para campus e `lean`.                             | Chamar `repository.listar({ params: { id: mockInventarioId } })`. Mockar `this.model.findById().populate().lean().exec()` para resolver com `mockInventarioDataComCampusPopulado`.                                                                                         | `this.model.findById` é chamado com `mockInventarioId`. `populate` é chamado com `{ path: 'campus', select: 'nome _id' }`. `lean` é chamado. O método retorna `mockInventarioDataComCampusPopulado`.                                                                                           |
| Listar (por ID - não encontrado)                 | Se um ID é fornecido e o inventário não é encontrado, deve lançar `CustomError`.                                                                       | Chamar `repository.listar({ params: { id: mockInventarioIdInexistente } })`. Mockar `this.model.findById().populate().lean().exec()` para resolver com `null`.                                                                                                       | `this.model.findById` é chamado. `CustomError` é lançado com `statusCode: 404`, `errorType: "resourceNotFound"`, `field: "Inventário"`, e mensagem `messages.error.resourceNotFound("Inventário")`.                                                                                       |
| Listar (sem ID - com filtros e paginação)        | Se nenhum ID é fornecido, deve construir filtros via `InventarioFilterBuilder`, aplicar paginação, `populate`, `sort` e `lean`.                        | Chamar `repository.listar({ query: { nome: 'Test', ativo: 'false', data: '2023-01-01', page: '2', campus: 'campusId', limite: '20' } })`. Mockar `InventarioFilterBuilder` (e seus métodos `comNome`, `comAtivo`, `comData`, `comCampus`, `build`) e `this.model.paginate()`. | `InventarioFilterBuilder` é instanciado. Métodos `comNome`, `comAtivo`, `comData`, `comCampus` e `build` são chamados. `this.model.paginate` é chamado com filtros construídos e opções de paginação corretas (page: 2, limit: 20, populate, sort, lean). Retorna `mockPaginatedData`. |
| Listar (sem ID - filtros e paginação padrão)     | Deve usar valores padrão para filtros e paginação se não fornecidos na query (`ativo=true`, `limite=10`, `page=1`).                                     | Chamar `repository.listar({ query: {} })`. Mockar `InventarioFilterBuilder.build` e `this.model.paginate()`.                                                                                                                                                               | `InventarioFilterBuilder` é chamado com valores padrão/vazios (e.g., `ativo` usado como `true` internamente ou no builder). `this.model.paginate` é chamado com opções de paginação padrão (`page: 1`, `limit: 10`).                                                                              |
| Listar (sem ID - limite máximo)                  | Deve restringir o parâmetro `limite` da paginação a um máximo de 100.                                                                                  | Chamar `repository.listar({ query: { limite: '200' } })`. Mockar `this.model.paginate()`.                                                                                                                                                                              | `this.model.paginate` é chamado com `limit: 100`.                                                                                                                                                                                                                                   |
| Listar (sem ID - erro `filterBuilder.build`)     | Deve lançar `CustomError` com status 500 se `filterBuilder.build` não for uma função (guarda interna).                                                  | Chamar `repository.listar({ query: {} })`. Mockar `InventarioFilterBuilder` para que `build` seja `undefined` ou não seja uma função.                                                                                                                                  | `CustomError` é lançado com `statusCode: 500`, `errorType: "internalServerError"`, `field: "Inventário"`, e mensagem `messages.error.internalServerError("Inventário")`.                                                                                                             |
| **Criar Inventário (Repositório)** |                                                                                                                                                      |                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                 |
| Criar inventário                                 | Deve instanciar `this.model` com os dados fornecidos e chamar `save()`.                                                                                | Chamar `repository.criar(novoInventarioData)`. Mockar construtor `this.model` e o método `save` da instância mockada para resolver com `inventarioSalvo`.                                                                                                          | `this.model` é instanciado com `novoInventarioData`. O método `save()` da instância é chamado. O método do repositório retorna `inventarioSalvo`.                                                                                                                                    |
| **Atualizar Inventário (Repositório)** |                                                                                                                                                      |                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                 |
| Atualizar inventário (encontrado)                | Deve atualizar um inventário por ID usando `findByIdAndUpdate`, aplicar `populate` para campus, `lean`, e retornar os dados atualizados.               | Chamar `repository.atualizar(mockInventarioId, dadosAtualizacao)`. Mockar `this.model.findByIdAndUpdate().populate().lean().exec()` para resolver com `inventarioAtualizadoComCampus`.                                                                              | `this.model.findByIdAndUpdate` é chamado com `mockInventarioId`, `dadosAtualizacao` e `{ new: true }`. `populate` e `lean` são chamados. O método retorna `inventarioAtualizadoComCampus`.                                                                                           |
| Atualizar inventário (não encontrado)            | Deve lançar `CustomError` se o inventário não for encontrado para atualização (i.e., `findByIdAndUpdate` retorna `null`).                                | Chamar `repository.atualizar(mockInventarioIdInexistente, dadosAtualizacao)`. Mockar `this.model.findByIdAndUpdate().populate().lean().exec()` para resolver com `null`.                                                                                            | `this.model.findByIdAndUpdate` é chamado. `CustomError` é lançado com `statusCode: 404`, `errorType: "resourceNotFound"`, `field: "Inventário"`, e mensagem `messages.error.resourceNotFound("Inventário")`.                                                                         |
| **Deletar Inventário (Repositório)** |                                                                                                                                                      |                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                 |
| Deletar inventário (existente)                   | Deve deletar um inventário por ID usando `findByIdAndDelete` e retornar o resultado da operação (o documento deletado).                                  | Chamar `repository.deletar(mockInventarioId)`. Mockar `this.model.findByIdAndDelete()` para resolver com o `mockInventarioDeletadoDocumento`.                                                                                                                           | `this.model.findByIdAndDelete` é chamado com `mockInventarioId`. O método retorna `mockInventarioDeletadoDocumento`.                                                                                                                                                            |
| Deletar inventário (não existente)               | Deve chamar `findByIdAndDelete`. Se o inventário não existir, `findByIdAndDelete` retornará `null`, e o repositório retornará `null`.                   | Chamar `repository.deletar('idInexistente')`. Mockar `this.model.findByIdAndDelete()` para resolver com `null`.                                                                                                                                                             | `this.model.findByIdAndDelete` é chamado com `'idInexistente'`. O método retorna `null`. Nenhuma exceção é lançada pelo repositório neste caso.                                                                                                                                    |

# Plano de Teste ENDPOINT (Sprint X)
*(A ser preenchido)*
