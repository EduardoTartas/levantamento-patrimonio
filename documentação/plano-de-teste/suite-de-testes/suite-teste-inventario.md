# Plano de Teste para Model (Milestone 2 - Sprint 3)

| Funcionalidade                               | Comportamento Esperado                                                                                                     | Verificações                                                                                                | Critérios de Aceite                                                                                                                               |
| :------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------ |
| Validação de Campos Obrigatórios (Criação) | Um inventário só pode ser cadastrado se possuir `campus`, `nome` e `data` preenchidos.                                     | Tentar salvar inventário sem `campus`, `nome` ou `data`.                                                  | A operação deve falhar com erro de validação (`Path \`...\` is required`).                                                                        |
| Cadastro Válido de Inventário              | Um inventário com `campus`, `nome` e `data` válidos deve ser salvo com sucesso, com `status` padrão `true` e timestamps.       | Inserir um inventário com todos os campos obrigatórios válidos, sem fornecer `status`.                       | O inventário é salvo, retornado com `_id`, `createdAt`, `updatedAt`, e o campo `status` é `true`. O campo `__v` não deve estar presente.       |
| Validação de Formato de Campos (Criação)   | Os campos `campus` devem ser um ObjectId válido e `data` deve ser uma data válida.                                           | Tentar salvar inventário com `campus` não ObjectId ou `data` inválida.                                   | A operação deve falhar com erro de cast (`Cast to ObjectId failed...` ou `Cast to date failed...`).                                             |
| Leitura de Inventários                       | O sistema deve retornar todos os inventários cadastrados ou uma lista paginada conforme solicitado.                        | Fazer `find()` para todos e `paginate()` com opções de página/limite.                                      | A resposta contém um array com os inventários ou um objeto de paginação (`docs`, `totalDocs`, etc.) com os dados corretos.                     |
| Atualização de Inventário                  | Deve ser possível atualizar campos como `nome`, `status`, `data`, `campus` de um inventário existente.                      | Alterar e salvar campos de um inventário existente.                                                        | O inventário reflete as alterações e o campo `updatedAt` é atualizado.                                                                            |
| Validação em Atualização                     | Campos obrigatórios (`nome`, `data`, `campus`) não podem ser atualizados para valores nulos ou inválidos.                   | Tentar atualizar campos obrigatórios para `null` ou string vazia/formato inválido.                          | A operação deve falhar com erro de validação (`Path \`...\` is required` ou erro de cast).                                                        |
| Remoção de Inventário                        | Um inventário existente pode ser removido do sistema.                                                                      | Usar `deleteOne()` ou `findByIdAndDelete()` em um inventário existente.                                     | A remoção é bem-sucedida (`deletedCount` é 1) e o inventário não é mais encontrado.                                                              |

# Plano de Teste Controller (Milestone 2 - Sprint 3)

| Funcionalidade                      | Comportamento Esperado                                                                                                | Verificações                                                                                               | Critérios de Aceite                                                                                                                                  |
| :---------------------------------- | :-------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------- |
| Listagem de Inventários (Geral)     | Deve listar todos os inventários se nenhum ID ou query for fornecida, ou filtrar conforme query, ou buscar por ID.        | Chamar `listar()` sem parâmetros, com query válida, e com ID válido.                                      | O serviço é chamado corretamente; `CommonResponse.success` é retornado com os dados apropriados (lista total, filtrada ou individual).             |
| Validação de Entrada (Listagem)     | Deve propagar erro se a validação de ID (Zod) ou da query (Zod) falhar ao listar.                                       | Chamar `listar()` com ID inválido ou query inválida.                                                      | O método `listar` do controller lança o erro de validação do Zod; o serviço não é chamado.                                                           |
| Criação de Inventário               | Deve validar os dados do corpo, chamar o serviço para criar, e retornar sucesso com os dados do inventário.             | Chamar `criar()` com dados válidos no corpo.                                                               | `InventarioSchema.parse` é chamado; `InventarioService.criar` é chamado; `CommonResponse.created` é retornado com os dados do inventário.          |
| Validação de Entrada (Criação)      | Deve propagar erro se a validação dos dados do corpo (Zod) falhar ao criar.                                             | Chamar `criar()` com dados inválidos no corpo.                                                             | O método `criar` do controller lança o erro de validação do Zod; o serviço não é chamado.                                                            |
| Atualização de Inventário           | Deve validar ID e dados do corpo, chamar o serviço para atualizar, e retornar sucesso com mensagem e dados atualizados. | Chamar `atualizar()` com ID e corpo válidos.                                                               | Schemas de ID e Update são validados; `InventarioService.atualizar` é chamado; `CommonResponse.success` com inventário atualizado e mensagem. |
| Validação de Entrada (Atualização)  | Deve propagar erro se a validação do ID (Zod) ou dos dados do corpo (Zod) falhar ao atualizar.                        | Chamar `atualizar()` com ID inválido ou corpo inválido.                                                    | O método `atualizar` do controller lança o erro de validação do Zod; o serviço não é chamado.                                                        |
| Deleção de Inventário               | Deve validar o ID, chamar o serviço para deletar, e retornar sucesso com mensagem e dados da deleção.                   | Chamar `deletar()` com ID válido.                                                                          | `InventarioIdSchema.parse` é chamado; `InventarioService.deletar` é chamado; `CommonResponse.success` com resposta do serviço e mensagem.       |
| Validação de Entrada (Deleção)      | Deve propagar erro se a validação do ID (Zod) falhar ao deletar.                                                        | Chamar `deletar()` com ID inválido.                                                                        | O método `deletar` do controller lança o erro de validação do Zod; o serviço não é chamado.                                                          |
| Propagação de Erro do Serviço       | Deve propagar erros originados no `InventarioService` para qualquer operação (listar, criar, atualizar, deletar).         | Mockar o método do serviço correspondente para lançar um erro.                                             | O método do controller correspondente lança o mesmo erro vindo do serviço.                                                                           |

# Plano de Teste Service (Milestone 2 - Sprint 3)

| Funcionalidade                                  | Comportamento Esperado                                                                                                                    | Verificações                                                                                                                               | Critérios de Aceite                                                                                                                                                                                |
| :---------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Listar Inventários (Serviço)                    | Deve chamar `repository.listar` com os parâmetros da requisição e retornar os dados.                                                        | Chamar `service.listar(mockReq)`.                                                                                                          | `repository.listar` é chamado com `mockReq`; o resultado do repositório é retornado.                                                                                                             |
| Criar Inventário (Serviço)                      | Deve verificar a existência do campus e, se existir, chamar `repository.criar` e retornar o inventário criado.                              | Chamar `service.criar(mockParsedData)`. Mockar `campusService.ensureCampExists` para sucesso.                                            | `campusService.ensureCampExists` é chamado; `repository.criar` é chamado; o inventário criado é retornado.                                                                                       |
| Falha ao Criar (Campus Inexistente)             | Deve lançar erro se o campus referenciado na criação do inventário não existir.                                                             | Chamar `service.criar(mockParsedData)`. Mockar `campusService.ensureCampExists` para falhar.                                             | `campusService.ensureCampExists` é chamado; o erro de campus inexistente é lançado; `repository.criar` não é chamado.                                                                            |
| Atualizar Inventário (Serviço)                  | Deve garantir que o inventário exista e esteja ativo. Se um novo campus for fornecido, sua existência deve ser verificada. Chama `repository.atualizar`. | Chamar `service.atualizar(mockId, mockUpdateData)` com e sem campus novo. Mockar `ensureInvExists` e `campusService.ensureCampExists` para sucesso. | `ensureInvExists` é chamado. Se campus nos dados, `campusService.ensureCampExists` é chamado. `repository.atualizar` é chamado; o inventário atualizado é retornado.                           |
| Falha ao Atualizar (Inventário Inexistente/Inativo) | Deve lançar erro se o inventário a ser atualizado não existir ou estiver inativo (status: false).                                         | Chamar `service.atualizar()` para ID inexistente ou ID de inventário inativo (mockando `ensureInvExists` ou `repository.buscarPorId` para simular). | `ensureInvExists` é chamado e lança `CustomError` (NOT\_FOUND ou BAD\_REQUEST para inativo); `repository.atualizar` não é chamado.                                                              |
| Falha ao Atualizar (Campus Novo Inexistente)    | Deve lançar erro se um novo campus for fornecido na atualização e este não existir.                                                         | Chamar `service.atualizar()` com dados contendo campus inexistente. Mockar `ensureInvExists` para sucesso e `campusService.ensureCampExists` para falha. | `ensureInvExists` é chamado. `campusService.ensureCampExists` é chamado e lança erro; `repository.atualizar` não é chamado.                                                                       |
| Deletar Inventário (Serviço)                    | Deve garantir que o inventário exista e esteja ativo, então chamar `repository.deletar`.                                                    | Chamar `service.deletar(mockId)`. Mockar `ensureInvExists` para sucesso.                                                                   | `ensureInvExists` é chamado; `repository.deletar` é chamado; a resposta da deleção é retornada.                                                                                                  |
| Falha ao Deletar (Inventário Inexistente/Inativo) | Deve lançar erro se o inventário a ser deletado não existir ou estiver inativo.                                                           | Chamar `service.deletar()` para ID inexistente ou ID de inventário inativo (mockando `ensureInvExists` ou `repository.buscarPorId` para simular).  | `ensureInvExists` é chamado e lança `CustomError` (NOT\_FOUND ou BAD\_REQUEST para inativo); `repository.deletar` não é chamado.                                                                 |
| Propagação de Erro do Repositório (Serviço)     | Deve propagar erros originados no `repository` (exceto "não encontrado" que é tratado) ou `campusService`.                                | Mockar o método do repositório ou `campusService` relevante para lançar um erro.                                                            | A chamada ao método do serviço correspondente rejeita com o mesmo erro lançado pelo repositório/`campusService`.                                                                                 |
| Auxiliar `ensureInvExists`                      | Deve buscar inventário por ID. Se não encontrado, lança `CustomError` (NOT\_FOUND). Se encontrado e inativo (para update/delete), lança `CustomError` (BAD\_REQUEST). | Chamar `ensureInvExists()` com ID existente (ativo/inativo) e inexistente.                                                                 | `repository.buscarPorId` é chamado. Retorna inventário se ativo e válido para operação. Lança `CustomError` apropriado caso contrário.                                                             |

# Plano de Teste Repository (Milestone 2 - Sprint 3)

| Funcionalidade                                  | Comportamento Esperado                                                                                                                             | Verificações                                                                                                                                                                  | Critérios de Aceite                                                                                                                                                                                           |
| :---------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Inicialização do Repositório                    | Deve instanciar corretamente e falhar se o modelo injetado não possuir o método `paginate`.                                                         | Instanciar `InventarioRepository` com mock de modelo válido e inválido (sem `paginate`).                                                                                        | Instanciação bem-sucedida com modelo válido. Erro lançado se `paginate` não existir no modelo, com mensagem específica.                                                                                    |
| Buscar Inventário por ID (Método `buscarPorId`) | Deve buscar um inventário pelo ID. Se não encontrado, deve lançar `CustomError` (NOT\_FOUND).                                                        | Chamar `repository.buscarPorId()` com ID existente e inexistente.                                                                                                               | `this.model.findById` é chamado. Retorna dados do inventário se encontrado. Lança `CustomError` (404, "resourceNotFound", "Inventário") se não encontrado.                                                    |
| Listar Inventários (Método `listar`)            | Se ID fornecido, busca por ID com `populate` e `lean`. Se não, usa `InventarioFilterBuilder` e `paginate` com opções, `populate`, `sort` e `lean`. | Chamar `repository.listar()` com ID (`req.params.id`), e com várias queries (`req.query`) para testar filtros, paginação padrão/customizada e limite máximo (100).             | Para ID: `findById().populate().lean()` é chamado. Retorna dados ou `CustomError` (404) se não encontrado. Para query: `FilterBuilder` é usado; `model.paginate()` é chamado com filtros e opções corretas. |
| Falha Interna no `listar` (FilterBuilder)       | Deve lançar `CustomError` (500) se `filterBuilder.build` não for uma função (guarda interna).                                                        | Chamar `repository.listar()` mockando `InventarioFilterBuilder` para ter `build` inválido.                                                                                      | `CustomError` (500, "internalServerError", "Inventário") é lançado.                                                                                                                                        |
| Criar Inventário (Repositório)                  | Deve instanciar o modelo com os dados fornecidos e chamar `save()`.                                                                                | Chamar `repository.criar(novoInventarioData)`.                                                                                                                                | `this.model` é instanciado com os dados; `save()` é chamado; o inventário salvo é retornado.                                                                                                              |
| Atualizar Inventário (Repositório)              | Deve atualizar usando `findByIdAndUpdate` com `new: true`, `populate`, `lean`. Lança `CustomError` (NOT\_FOUND) se não encontrado.                 | Chamar `repository.atualizar()` com ID existente e inexistente, e dados de atualização.                                                                                         | `findByIdAndUpdate()` é chamado com ID, dados e opções. Retorna dados atualizados. Lança `CustomError` (404, "resourceNotFound", "Inventário") se `findByIdAndUpdate` retorna `null`.                           |
| Deletar Inventário (Repositório)                | Deve deletar usando `findByIdAndDelete`. Retorna o documento deletado ou `null` se não encontrado (não lança erro aqui).                           | Chamar `repository.deletar()` com ID existente e inexistente.                                                                                                                 | `findByIdAndDelete()` é chamado com ID. Retorna o documento deletado ou `null` se não foi encontrado.                                                                                                       |
