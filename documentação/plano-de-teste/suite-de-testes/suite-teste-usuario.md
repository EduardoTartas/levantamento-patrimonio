# Plano de Teste para Model (Milestone 2 - Sprint 3)

| Funcionalidade                      | Comportamento Esperado                                                                                                   | Verificações                                                                                                | Critérios de Aceite                                                                                             |
| :---------------------------------- | :----------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------ | :-------------------------------------------------------------------------------------------------------------- |
| **Criação de Usuário** |                                                                                                                          |                                                                                                               |                                                                                                                 |
| Campos obrigatórios                 | Um usuário só pode ser cadastrado se possuir `campus`, `nome`, `CPF`, `email` e `cargo`.                                   | Tentar salvar usuário sem `campus`, `nome`, `cpf`, `email` ou `cargo` (individualmente e com strings vazias). | A operação deve falhar com erro de validação indicando que o respectivo campo é obrigatório (`Path \`...\` is required`). |
| Cadastro válido (com/sem senha)     | Um usuário com todos os campos obrigatórios válidos (e senha opcional) deve ser salvo com sucesso.                       | Inserir um usuário com todos os campos obrigatórios preenchidos corretamente (com e sem o campo `senha`).   | O usuário é salvo e retornado com `_id`, `createdAt`, `updatedAt` e os campos fornecidos corretamente.             |
| Cadastro sem Senha                  | Um usuário pode ser cadastrado sem fornecer o campo `senha`, pois não é obrigatório no schema Mongoose.                  | Cadastrar um usuário omitindo o campo `senha` dos dados de entrada.                                           | O usuário é salvo com sucesso e o campo `senha` no documento recuperado (mesmo com `.select('+senha')`) é `undefined`. |
| CPF único                           | O sistema deve garantir que o CPF do usuário seja único na coleção.                                                      | Tentar cadastrar dois usuários com o mesmo `cpf`, mas emails diferentes.                                        | A segunda operação de salvamento deve falhar com um erro de chave duplicada (`E11000 duplicate key error`).      |
| Email único                         | O sistema deve garantir que o email do usuário seja único na coleção.                                                    | Tentar cadastrar dois usuários com o mesmo `email`, mas CPFs diferentes.                                        | A segunda operação de salvamento deve falhar com um erro de chave duplicada (`E11000 duplicate key error`).      |
| Valor padrão de status              | Ao cadastrar um usuário sem informar o campo `status`, o valor padrão no documento salvo deve ser `true`.                | Cadastrar um usuário sem incluir o campo `status` nos dados de entrada.                                       | O campo `status` do usuário salvo deve ser `true`.                                                              |
| Validação de Cargo (Nível Model)    | O campo `cargo` é obrigatório e aceita qualquer string, pois o schema Mongoose não define um enum para ele.              | Cadastrar um usuário com um valor de string arbitrário para `cargo`.                                          | O usuário é salvo com sucesso com o valor de `cargo` fornecido.                                                 |
| Validação de Formato do Campus      | O campo `campus` deve ser um ObjectId válido para ser salvo.                                                             | Tentar salvar um usuário fornecendo uma string que não é um formato ObjectId válido para o campo `campus`.      | A operação deve falhar com um erro de cast para ObjectId (`Cast to ObjectId failed`).                           |
| Registro de timestamps              | O sistema deve registrar automaticamente as datas de criação (`createdAt`) e atualização (`updatedAt`).                    | Cadastrar um usuário e verificar os campos `createdAt` e `updatedAt`.                                         | Os campos `createdAt` e `updatedAt` existem, são instâncias de `Date` e são preenchidos corretamente.           |
| **Leitura de Usuários** |                                                                                                                          |                                                                                                               |                                                                                                                 |
| Listar todos os usuários            | O sistema deve ser capaz de retornar todos os usuários cadastrados.                                                        | Após cadastrar múltiplos usuários, fazer `Usuario.find()` para buscar todos.                                   | A consulta retorna um array contendo o número correto de usuários cadastrados.                                  |
| **Atualização de Usuário** |                                                                                                                          |                                                                                                               |                                                                                                                 |
| Atualização de campos genéricos     | Deve ser possível atualizar informações de um usuário existente (ex: `nome`, `status`).                                    | Buscar um usuário, alterar seu `nome` e `status`, e salvar.                                                   | O usuário recuperado após a atualização reflete as alterações e o campo `updatedAt` é mais recente.             |
| Validação de campos obrigatórios    | Campos obrigatórios (ex: `nome`) não podem ser atualizados para valores vazios se o schema assim o define.                 | Tentar atualizar o `nome` de um usuário para uma string vazia.                                                | A operação de salvamento deve falhar com erro de validação (`Path \`nome\` is required`).                         |
| Atualização/Remoção de Senha        | Deve ser possível atualizar a senha de um usuário para um novo valor ou "removê-la" definindo-a como `undefined`.        | Atualizar o campo `senha` para um novo valor. Depois, atualizar o campo `senha` para `undefined`.             | O campo `senha` é alterado para o novo valor (ou seu hash). Ao ser definido como `undefined`, ele fica `undefined` no banco. |
| Manutenção de Senha                 | Se o campo `senha` não for explicitamente fornecido durante uma atualização de outros campos, ele deve permanecer inalterado. | Atualizar um campo (ex: `nome`) de um usuário sem incluir `senha` nos dados da atualização.                   | O campo `senha` do usuário permanece o mesmo de antes da atualização.                                           |
| Atualização de Cargo (Nível Model)  | O campo `cargo` pode ser atualizado para qualquer string, pois o schema Mongoose não define um enum para ele.           | Atualizar o `cargo` de um usuário para um valor de string arbitrário.                                         | O usuário é atualizado com sucesso com o novo valor de `cargo`.                                                 |
| **Remoção de Usuário** |                                                                                                                          |                                                                                                               |                                                                                                                 |
| Remoção de usuário existente        | Um usuário existente deve poder ser removido do sistema.                                                                   | Cadastrar um usuário, depois usar `Usuario.deleteOne()` para removê-lo.                                       | A operação de remoção é bem-sucedida (`deletedCount` é 1) e o usuário não é mais encontrado por `findById`.     |

# Plano de Teste Controller (Milestone 2 - Sprint 3)

| Funcionalidade                      | Comportamento Esperado                                                                                                  | Verificações                                                                                                                               | Critérios de Aceite                                                                                                                                                                                          |
| :---------------------------------- | :---------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Listar Usuários** |                                                                                                                         |                                                                                                                                            |                                                                                                                                                                                                            |
| Listar todos (sem ID/query)         | O controller deve chamar o serviço para listar todos os usuários e retornar uma resposta de sucesso.                        | Chamar `listar()` sem `id` nos parâmetros e sem `query`. Mockar `UsuarioService.listar` para retornar uma lista de usuários.                | `UsuarioIdSchema.parse` não é chamado. `UsuarioQuerySchema.parseAsync` é chamado com objeto vazio. `UsuarioService.listar` é chamado. `CommonResponse.success` é chamado com a lista de usuários.             |
| Listar usuário por ID               | O controller deve validar o ID, chamar o serviço para buscar um usuário específico e retornar uma resposta de sucesso.        | Chamar `listar()` com um `id` válido nos parâmetros. Mockar `UsuarioIdSchema.parse` e `UsuarioService.listar` para sucesso.                | `UsuarioIdSchema.parse` é chamado com o ID. `UsuarioService.listar` é chamado. `CommonResponse.success` é chamado com o usuário encontrado.                                                                |
| Listar usuários com query           | O controller deve validar a query, chamar o serviço para buscar usuários filtrados e retornar uma resposta de sucesso.      | Chamar `listar()` com parâmetros de `query` válidos. Mockar `UsuarioQuerySchema.parseAsync` e `UsuarioService.listar` para sucesso.     | `UsuarioQuerySchema.parseAsync` é chamado com a query. `UsuarioService.listar` é chamado. `CommonResponse.success` é chamado com a lista de usuários filtrados.                                                |
| Falha na validação de ID (Listar)   | Se a validação do ID via Zod falhar, o controller deve propagar o erro.                                                 | Chamar `listar()` com um `id` inválido. Mockar `UsuarioIdSchema.parse` para lançar um erro.                                                | O método `listar` do controller lança o erro. `UsuarioService.listar` não é chamado.                                                                                                                          |
| Falha na validação de query         | Se a validação da query via Zod falhar, o controller deve propagar o erro.                                              | Chamar `listar()` com uma `query` inválida. Mockar `UsuarioQuerySchema.parseAsync` para lançar um erro.                                  | O método `listar` do controller lança o erro. `UsuarioService.listar` não é chamado.                                                                                                                          |
| Erro no serviço (Listar)            | Se o método `listar` do serviço lançar um erro, o controller deve propagar esse erro.                                     | Mockar `UsuarioService.listar` para rejeitar com um erro.                                                                                  | O método `listar` do controller lança o erro vindo do serviço.                                                                                                                                               |
| **Criar Usuário** |                                                                                                                         |                                                                                                                                            |                                                                                                                                                                                                            |
| Criação bem-sucedida                | O controller deve validar os dados do corpo da requisição, chamar o serviço para criar o usuário e retornar sucesso.        | Chamar `criar()` com dados válidos no `body`. Mockar `UsuarioSchema.parse` e `UsuarioService.criar` (retornando usuário com `toObject`). | `UsuarioSchema.parse` é chamado com os dados do corpo. `UsuarioService.criar` é chamado com os dados parseados. O método `toObject()` é chamado. `CommonResponse.created` é chamado com o usuário (sem senha). |
| Falha na validação (Criar)          | Se a validação dos dados do corpo da requisição via Zod falhar, o controller deve propagar o erro.                      | Chamar `criar()` com dados inválidos no `body`. Mockar `UsuarioSchema.parse` para lançar um erro.                                         | O método `criar` do controller lança o erro. `UsuarioService.criar` não é chamado.                                                                                                                           |
| Erro no serviço (Criar)             | Se o método `criar` do serviço lançar um erro, o controller deve propagar esse erro.                                      | Chamar `criar()` com dados válidos. Mockar `UsuarioService.criar` para rejeitar com um erro.                                             | O método `criar` do controller lança o erro vindo do serviço.                                                                                                                                                |
| **Atualizar Usuário** |                                                                                                                         |                                                                                                                                            |                                                                                                                                                                                                            |
| Atualização bem-sucedida            | O controller deve validar o ID e os dados do corpo, chamar o serviço para atualizar e retornar sucesso com mensagem.        | Chamar `atualizar()` com `id` e `body` válidos. Mockar `UsuarioIdSchema.parse`, `UsuarioUpdateSchema.parse` e `UsuarioService.atualizar`. | `UsuarioIdSchema.parse` e `UsuarioUpdateSchema.parse` são chamados. `UsuarioService.atualizar` é chamado com ID e dados. `CommonResponse.success` é chamado com usuário atualizado e mensagem específica.     |
| Falha na validação de ID (Att)      | Se a validação do ID via Zod falhar, o controller deve propagar o erro.                                                 | Chamar `atualizar()` com um `id` inválido. Mockar `UsuarioIdSchema.parse` para lançar um erro.                                             | O método `atualizar` do controller lança o erro. `UsuarioService.atualizar` não é chamado.                                                                                                                   |
| Falha na validação (Att)            | Se a validação dos dados do corpo via Zod falhar, o controller deve propagar o erro.                                    | Chamar `atualizar()` com `body` inválido. Mockar `UsuarioUpdateSchema.parse` para lançar um erro.                                        | O método `atualizar` do controller lança o erro. `UsuarioService.atualizar` não é chamado.                                                                                                                   |
| Erro no serviço (Att)               | Se o método `atualizar` do serviço lançar um erro, o controller deve propagar esse erro.                                  | Chamar `atualizar()` com dados válidos. Mockar `UsuarioService.atualizar` para rejeitar com um erro.                                     | O método `atualizar` do controller lança o erro vindo do serviço.                                                                                                                                            |
| **Deletar Usuário** |                                                                                                                         |                                                                                                                                            |                                                                                                                                                                                                            |
| Deleção bem-sucedida                | O controller deve validar o ID, chamar o serviço para deletar o usuário e retornar sucesso com mensagem.                    | Chamar `deletar()` com um `id` válido. Mockar `UsuarioIdSchema.parse` e `UsuarioService.deletar`.                                        | `UsuarioIdSchema.parse` é chamado com o ID. `UsuarioService.deletar` é chamado com o ID. `CommonResponse.success` é chamado com a resposta do serviço e mensagem específica.                                  |
| Falha na validação de ID (Del)      | Se a validação do ID via Zod falhar, o controller deve propagar o erro.                                                 | Chamar `deletar()` com um `id` inválido. Mockar `UsuarioIdSchema.parse` para lançar um erro.                                               | O método `deletar` do controller lança o erro. `UsuarioService.deletar` não é chamado.                                                                                                                       |
| Erro no serviço (Del)               | Se o método `deletar` do serviço lançar um erro, o controller deve propagar esse erro.                                    | Chamar `deletar()` com `id` válido. Mockar `UsuarioService.deletar` para rejeitar com um erro.                                           | O método `deletar` do controller lança o erro vindo do serviço.                                                                                                                                              |

# Plano de Teste Server (Milestone 2 - Sprint 3)

*(A ser preenchido)*

# Plano de Teste Repository (Milestone 2 - Sprint 3)

*(A ser preenchido)*

# Plano de Teste ENDPOINT (Sprint X)

*(A ser preenchido)*