# Plano de Teste para Model (Milestone 2 - Sprint 3)

| Funcionalidade                      | Comportamento Esperado                                                                                                   | Verificações                                                                                                | Critérios de Aceite                                                                                             |
| :---------------------------------- | :----------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------ | :-------------------------------------------------------------------------------------------------------------- |
| **Criação de Usuário** |                                                                                                                          |                                                                                                               |                                                                                                                 |
| Campos obrigatórios                 | Um usuário só pode ser cadastrado se possuir `campus`, `nome`, `CPF`, `email` e `cargo`.                                   | Tentar salvar usuário sem `campus`, `nome`, `cpf`, `email` ou `cargo` (individualmente e com strings vazias). | A operação deve falhar com erro de validação indicando que o respectivo campo é obrigatório (`Path \`...\` is required`). |
| Cadastro válido (com/sem senha)     | Um usuário com todos os campos obrigatórios válidos (e senha opcional) deve ser salvo com sucesso.                       | Inserir um usuário com todos os campos obrigatórios preenchidos corretamente (com e sem o campo `senha`).   | O usuário é salvo e retornado com `_id`, `createdAt`, `updatedAt` e os campos fornecidos corretamente.             |
| Cadastro sem Senha                  | Um usuário pode ser cadastrado sem fornecer o campo `senha`, pois não é obrigatório no schema Mongoose.                  | Cadastrar um usuário omitindo o campo `senha` dos dados de entrada.                                           | O usuário é salvo com sucesso e o campo `senha` no documento recuperado (mesmo com `.select('+senha')`) é `undefined`. |
| CPF único                           | O sistema deve garantir que o CPF do usuário seja único na coleção.                                                      | Tentar cadastrar dois usuários com o mesmo `cpf`, mas emails diferentes.                                        | A segunda operação de salvamento deve falhar com um erro de chave duplicada (`E11000 duplicate key error`).      |
| Email único                         | O sistema deve garantir que o email do usuário seja único na coleção.                                                    | Tentar cadastrar dois usuários com o mesmo `email`, mas CPFs diferentes.                                        | A segunda operação de salvamento deve falhar com um erro de chave duplicada (`E11000 duplicate key error`).      |
| Valor padrão de status              | Ao cadastrar um usuário sem informar o campo `status`, o valor padrão no documento salvo deve ser `true`.                | Cadastrar um usuário sem incluir o campo `status` nos dados de entrada.                                       | O campo `status` do usuário salvo deve ser `true`.                                                              |
| Validação de Cargo (Nível Model)    | O campo `cargo` é obrigatório e aceita qualquer string, pois o schema Mongoose não define um enum para ele.              | Cadastrar um usuário com um valor de string arbitrário para `cargo`.                                          | O usuário é salvo com sucesso com o valor de `cargo` fornecido.                                                 |
| Validação de Formato do Campus      | O campo `campus` deve ser um ObjectId válido para ser salvo.                                                             | Tentar salvar um usuário fornecendo uma string que não é um formato ObjectId válido para o campo `campus`.      | A operação deve falhar com um erro de cast para ObjectId (`Cast to ObjectId failed`).                           |
| Registro de timestamps              | O sistema deve registrar automaticamente as datas de criação (`createdAt`) e atualização (`updatedAt`).                    | Cadastrar um usuário e verificar os campos `createdAt` e `updatedAt`.                                         | Os campos `createdAt` e `updatedAt` existem, são instâncias de `Date` e são preenchidos corretamente.           |
| **Leitura de Usuários** |                                                                                                                          |                                                                                                               |                                                                                                                 |
| Listar todos os usuários            | O sistema deve ser capaz de retornar todos os usuários cadastrados.                                                        | Após cadastrar múltiplos usuários, fazer `Usuario.find()` para buscar todos.                                   | A consulta retorna um array contendo o número correto de usuários cadastrados.                                  |
| **Atualização de Usuário** |                                                                                                                          |                                                                                                               |                                                                                                                 |
| Atualização de campos genéricos     | Deve ser possível atualizar informações de um usuário existente (ex: `nome`, `status`).                                    | Buscar um usuário, alterar seu `nome` e `status`, e salvar.                                                   | O usuário recuperado após a atualização reflete as alterações e o campo `updatedAt` é mais recente.             |
| Validação de campos obrigatórios    | Campos obrigatórios (ex: `nome`) não podem ser atualizados para valores vazios se o schema assim o define.                 | Tentar atualizar o `nome` de um usuário para uma string vazia.                                                | A operação de salvamento deve falhar com erro de validação (`Path \`nome\` is required`).                         |
| Atualização/Remoção de Senha        | Deve ser possível atualizar a senha de um usuário para um novo valor ou "removê-la" definindo-a como `undefined`.        | Atualizar o campo `senha` para um novo valor. Depois, atualizar o campo `senha` para `undefined`.             | O campo `senha` é alterado para o novo valor (ou seu hash). Ao ser definido como `undefined`, ele fica `undefined` no banco. |
| Manutenção de Senha                 | Se o campo `senha` não for explicitamente fornecido durante uma atualização de outros campos, ele deve permanecer inalterado. | Atualizar um campo (ex: `nome`) de um usuário sem incluir `senha` nos dados da atualização.                   | O campo `senha` do usuário permanece o mesmo de antes da atualização.                                           |
| Atualização de Cargo (Nível Model)  | O campo `cargo` pode ser atualizado para qualquer string, pois o schema Mongoose não define um enum para ele.           | Atualizar o `cargo` de um usuário para um valor de string arbitrário.                                         | O usuário é atualizado com sucesso com o novo valor de `cargo`.                                                 |
| **Remoção de Usuário** |                                                                                                                          |                                                                                                               |                                                                                                                 |
| Remoção de usuário existente        | Um usuário existente deve poder ser removido do sistema.                                                                   | Cadastrar um usuário, depois usar `Usuario.deleteOne()` para removê-lo.                                       | A operação de remoção é bem-sucedida (`deletedCount` é 1) e o usuário não é mais encontrado por `findById`.     |

# Plano de Teste Controller (Milestone 2 - Sprint 3)

| Funcionalidade                      | Comportamento Esperado                                                                                                  | Verificações                                                                                                                               | Critérios de Aceite                                                                                                                                                                                          |
| :---------------------------------- | :---------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Listar Usuários** |                                                                                                                         |                                                                                                                                            |                                                                                                                                                                                                            |
| Listar todos (sem ID/query)         | O controller deve chamar o serviço para listar todos os usuários e retornar uma resposta de sucesso.                        | Chamar `listar()` sem `id` nos parâmetros e sem `query`. Mockar `UsuarioService.listar` para retornar uma lista de usuários.                | `UsuarioIdSchema.parse` não é chamado. `UsuarioQuerySchema.parseAsync` é chamado com objeto vazio. `UsuarioService.listar` é chamado. `CommonResponse.success` é chamado com a lista de usuários.             |
| Listar usuário por ID               | O controller deve validar o ID, chamar o serviço para buscar um usuário específico e retornar uma resposta de sucesso.        | Chamar `listar()` com um `id` válido nos parâmetros. Mockar `UsuarioIdSchema.parse` e `UsuarioService.listar` para sucesso.                | `UsuarioIdSchema.parse` é chamado com o ID. `UsuarioService.listar` é chamado. `CommonResponse.success` é chamado com o usuário encontrado.                                                                |
| Listar usuários com query           | O controller deve validar a query, chamar o serviço para buscar usuários filtrados e retornar uma resposta de sucesso.      | Chamar `listar()` com parâmetros de `query` válidos. Mockar `UsuarioQuerySchema.parseAsync` e `UsuarioService.listar` para sucesso.     | `UsuarioQuerySchema.parseAsync` é chamado com a query. `UsuarioService.listar` é chamado. `CommonResponse.success` é chamado com a lista de usuários filtrados.                                                |
| Falha na validação de ID (Listar)   | Se a validação do ID via Zod falhar, o controller deve propagar o erro.                                                 | Chamar `listar()` com um `id` inválido. Mockar `UsuarioIdSchema.parse` para lançar um erro.                                                | O método `listar` do controller lança o erro. `UsuarioService.listar` não é chamado.                                                                                                                          |
| Falha na validação de query         | Se a validação da query via Zod falhar, o controller deve propagar o erro.                                              | Chamar `listar()` com uma `query` inválida. Mockar `UsuarioQuerySchema.parseAsync` para lançar um erro.                                  | O método `listar` do controller lança o erro. `UsuarioService.listar` não é chamado.                                                                                                                          |
| Erro no serviço (Listar)            | Se o método `listar` do serviço lançar um erro, o controller deve propagar esse erro.                                     | Mockar `UsuarioService.listar` para rejeitar com um erro.                                                                                  | O método `listar` do controller lança o erro vindo do serviço.                                                                                                                                               |
| **Criar Usuário** |                                                                                                                         |                                                                                                                                            |                                                                                                                                                                                                            |
| Criação bem-sucedida                | O controller deve validar os dados do corpo da requisição, chamar o serviço para criar o usuário e retornar sucesso.        | Chamar `criar()` com dados válidos no `body`. Mockar `UsuarioSchema.parse` e `UsuarioService.criar` (retornando usuário com `toObject`). | `UsuarioSchema.parse` é chamado com os dados do corpo. `UsuarioService.criar` é chamado com os dados parseados. O método `toObject()` é chamado. `CommonResponse.created` é chamado com o usuário (sem senha). |
| Falha na validação (Criar)          | Se a validação dos dados do corpo da requisição via Zod falhar, o controller deve propagar o erro.                      | Chamar `criar()` com dados inválidos no `body`. Mockar `UsuarioSchema.parse` para lançar um erro.                                         | O método `criar` do controller lança o erro. `UsuarioService.criar` não é chamado.                                                                                                                           |
| Erro no serviço (Criar)             | Se o método `criar` do serviço lançar um erro, o controller deve propagar esse erro.                                      | Chamar `criar()` com dados válidos. Mockar `UsuarioService.criar` para rejeitar com um erro.                                             | O método `criar` do controller lança o erro vindo do serviço.                                                                                                                                                |
| **Atualizar Usuário** |                                                                                                                         |                                                                                                                                            |                                                                                                                                                                                                            |
| Atualização bem-sucedida            | O controller deve validar o ID e os dados do corpo, chamar o serviço para atualizar e retornar sucesso com mensagem.        | Chamar `atualizar()` com `id` e `body` válidos. Mockar `UsuarioIdSchema.parse`, `UsuarioUpdateSchema.parse` e `UsuarioService.atualizar`. | `UsuarioIdSchema.parse` e `UsuarioUpdateSchema.parse` são chamados. `UsuarioService.atualizar` é chamado com ID e dados. `CommonResponse.success` é chamado com usuário atualizado e mensagem específica.     |
| Falha na validação de ID (Att)      | Se a validação do ID via Zod falhar, o controller deve propagar o erro.                                                 | Chamar `atualizar()` com um `id` inválido. Mockar `UsuarioIdSchema.parse` para lançar um erro.                                             | O método `atualizar` do controller lança o erro. `UsuarioService.atualizar` não é chamado.                                                                                                                   |
| Falha na validação (Att)            | Se a validação dos dados do corpo via Zod falhar, o controller deve propagar o erro.                                    | Chamar `atualizar()` com `body` inválido. Mockar `UsuarioUpdateSchema.parse` para lançar um erro.                                        | O método `atualizar` do controller lança o erro. `UsuarioService.atualizar` não é chamado.                                                                                                                   |
| Erro no serviço (Att)               | Se o método `atualizar` do serviço lançar um erro, o controller deve propagar esse erro.                                  | Chamar `atualizar()` com dados válidos. Mockar `UsuarioService.atualizar` para rejeitar com um erro.                                     | O método `atualizar` do controller lança o erro vindo do serviço.                                                                                                                                            |
| **Deletar Usuário** |                                                                                                                         |                                                                                                                                            |                                                                                                                                                                                                            |
| Deleção bem-sucedida                | O controller deve validar o ID, chamar o serviço para deletar o usuário e retornar sucesso com mensagem.                    | Chamar `deletar()` com um `id` válido. Mockar `UsuarioIdSchema.parse` e `UsuarioService.deletar`.                                        | `UsuarioIdSchema.parse` é chamado com o ID. `UsuarioService.deletar` é chamado com o ID. `CommonResponse.success` é chamado com a resposta do serviço e mensagem específica.                                  |
| Falha na validação de ID (Del)      | Se a validação do ID via Zod falhar, o controller deve propagar o erro.                                                 | Chamar `deletar()` com um `id` inválido. Mockar `UsuarioIdSchema.parse` para lançar um erro.                                               | O método `deletar` do controller lança o erro. `UsuarioService.deletar` não é chamado.                                                                                                                       |
| Erro no serviço (Del)               | Se o método `deletar` do serviço lançar um erro, o controller deve propagar esse erro.                                    | Chamar `deletar()` com `id` válido. Mockar `UsuarioService.deletar` para rejeitar com um erro.                                           | O método `deletar` do controller lança o erro vindo do serviço.                                                                                                                                              |

# Plano de Teste Service (Milestone 2 - Sprint 3)

| Funcionalidade                                  | Comportamento Esperado                                                                                                   | Verificações                                                                                                                                                                                            | Critérios de Aceite                                                                                                                                                                                                                                                                                                                       |
| :---------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Listar Usuários** |                                                                                                                          |                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                                                                                             |
| Listar usuários (sucesso)                       | Deve chamar `repository.listar` com os parâmetros corretos e retornar os dados.                                        | Chamar `service.listar` com `mockReq.query`. Mockar `repository.listar` para retornar `mockResponseData`.                                                                                                  | `repository.listar` é chamado com `mockReq`. O resultado é igual a `mockResponseData`.                                                                                                                                                                                                                                                  |
| Listar usuários (erro repo)                   | Deve propagar erros originados no `repository.listar`.                                                                 | Chamar `service.listar` com `mockReq`. Mockar `repository.listar` para rejeitar com um erro.                                                                                                              | A chamada a `service.listar` rejeita com o mesmo erro lançado pelo repositório.                                                                                                                                                                                                                                                          |
| **Criar Usuário** |                                                                                                                          |                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                                                                                             |
| Criar usuário (com senha)                       | Deve criar um usuário com sucesso, hasheando a senha fornecida.                                                            | Chamar `service.criar` com `mockParsedData` (incluindo senha). Mockar `repository.buscarPorEmail/Cpf` (null), `campusService.ensureCampExists` (true), `bcrypt.hash` (hashedPassword), `repository.criar`. | `repository.buscarPorEmail/Cpf` são chamados. `campusService.ensureCampExists` é chamado. `bcrypt.hash` é chamado com a senha original. `repository.criar` é chamado com dados incluindo a senha hasheada. O resultado contém a senha hasheada.                                                                              |
| Criar usuário (sem senha)                     | Deve criar um usuário com sucesso mesmo sem senha fornecida.                                                               | Chamar `service.criar` com `mockParsedData` (senha `undefined`). Mockar como no caso anterior, exceto `bcrypt.hash`.                                                                                      | `bcrypt.hash` não é chamado. `repository.criar` é chamado com dados sem senha. O resultado tem `senha` como `undefined`.                                                                                                                                                                                                                      |
| Criar (email duplicado)                       | Deve lançar `CustomError` se o email fornecido já estiver em uso.                                                            | Chamar `service.criar`. Mockar `repository.buscarPorEmail` para retornar um usuário existente.                                                                                                            | `repository.buscarPorEmail` é chamado. `CustomError` é lançado com `statusCode: BAD_REQUEST`, `field: "email"`, e mensagem "Email já está em uso.".                                                                                                                                                                                          |
| Criar (CPF duplicado)                         | Deve lançar `CustomError` se o CPF fornecido já estiver em uso.                                                              | Chamar `service.criar`. Mockar `repository.buscarPorCpf` para retornar um usuário existente.                                                                                                              | `repository.buscarPorCpf` é chamado. `CustomError` é lançado com `statusCode: BAD_REQUEST`, `field: "cpf"`, e mensagem "CPF já está em uso.".                                                                                                                                                                                             |
| Criar (campus inexistente)                    | Deve propagar o erro se `campusService.ensureCampExists` falhar (e.g., campus não existe).                                 | Chamar `service.criar`. Mockar `campusService.ensureCampExists` para rejeitar com um erro.                                                                                                                | `campusService.ensureCampExists` é chamado. A chamada a `service.criar` rejeita com o mesmo erro do `campusService`.                                                                                                                                                                                                                   |
| **Atualizar Usuário** |                                                                                                                          |                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                                                                                             |
| Atualizar usuário (sucesso)                   | Deve atualizar um usuário com sucesso. Campos `email` e `senha` são removidos dos dados de atualização antes de persistir. | Chamar `service.atualizar` com `userId` e `mockUpdateData`. Mockar `repository.buscarPorId` (usuário existente), `repository.buscarPorEmail/Cpf` (null), `campusService.ensureCampExists` (true), `repository.atualizar`. | `repository.buscarPorId`, `repository.buscarPorEmail/Cpf` (com `userId` para exclusão), `campusService.ensureCampExists` são chamados. `repository.atualizar` é chamado com `userId` e dados sem `email` e `senha`. Retorna o usuário atualizado.                                                                              |
| Atualizar (sem campus)                        | Deve atualizar um usuário com sucesso mesmo se o campo `campus` não for fornecido na atualização.                          | Chamar `service.atualizar` com dados sem `campus`. Mockar o necessário.                                                                                                                                     | `campusService.ensureCampExists` não é chamado. `repository.atualizar` é chamado com os dados fornecidos (sem `email`, `senha`).                                                                                                                                                                                                       |
| Atualizar (usuário não existe)                | Deve lançar `CustomError` se o usuário a ser atualizado não for encontrado.                                                | Chamar `service.atualizar`. Mockar `repository.buscarPorId` para retornar `null`.                                                                                                                         | `repository.buscarPorId` é chamado. `CustomError` é lançado com `statusCode: NOT_FOUND` e mensagem `messages.error.resourceNotFound("Usuário")`.                                                                                                                                                                                 |
| Atualizar (email duplicado)                   | Deve lançar `CustomError` se o novo email já estiver em uso por outro usuário.                                               | Chamar `service.atualizar`. Mockar `repository.buscarPorEmail` para retornar um usuário diferente.                                                                                                        | `repository.buscarPorEmail` é chamado. `CustomError` é lançado com `statusCode: BAD_REQUEST`, `field: "email"`.                                                                                                                                                                                                                          |
| Atualizar (CPF duplicado)                     | Deve lançar `CustomError` se o novo CPF já estiver em uso por outro usuário.                                                 | Chamar `service.atualizar`. Mockar `repository.buscarPorCpf` para retornar um usuário diferente.                                                                                                          | `repository.buscarPorCpf` é chamado. `CustomError` é lançado com `statusCode: BAD_REQUEST`, `field: "cpf"`.                                                                                                                                                                                                                             |
| Atualizar (email/CPF igual ao do usuário)     | Deve permitir a atualização se o email/CPF não mudou ou pertence ao mesmo usuário que está sendo atualizado.             | Chamar `service.atualizar` com email/CPF do próprio usuário. Mockar `repository.buscarPorEmail/Cpf` para retornar `null` (ao excluir o ID atual da busca por duplicidade).                                  | `repository.buscarPorEmail/Cpf` são chamados com o ID do usuário para exclusão na verificação. `repository.atualizar` é chamado e a operação é bem-sucedida.                                                                                                                                                                      |
| **Deletar Usuário** |                                                                                                                          |                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                                                                                             |
| Deletar usuário (sucesso)                     | Deve deletar um usuário existente com sucesso.                                                                             | Chamar `service.deletar` com `userIdValido`. Mockar `repository.buscarPorId` (usuário existente) e `repository.deletar`.                                                                                 | `repository.buscarPorId` é chamado. `repository.deletar` é chamado com `userIdValido`. O resultado é a mensagem de sucesso do repositório.                                                                                                                                                                                           |
| Deletar (usuário não existe)                  | Deve lançar `CustomError` se o usuário a ser deletado não for encontrado.                                                  | Chamar `service.deletar` com `idInexistente`. Mockar `repository.buscarPorId` para retornar `null`.                                                                                                       | `repository.buscarPorId` é chamado. `CustomError` é lançado com `statusCode: NOT_FOUND` e mensagem `messages.error.resourceNotFound("Usuário")`. `repository.deletar` não é chamado.                                                                                                                                                    |
| **`UsuarioService.validateEmail` (Auxiliar)** |                                                                                                                          |                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                                                                                             |
| Validar email (não em uso)                    | Não deve lançar erro se o email não estiver em uso ou pertencer ao `currentUserId`.                                          | Chamar `service.validateEmail` com `emailNovo` (e opcionalmente `currentUserId`). Mockar `repository.buscarPorEmail` para retornar `null`.                                                              | `repository.buscarPorEmail` é chamado. Nenhuma exceção é lançada.                                                                                                                                                                                                                                                                           |
| Validar email (em uso por outro)              | Deve lançar `CustomError` se o email já estiver em uso por um usuário diferente de `currentUserId`.                          | Chamar `service.validateEmail` com `emailExistente` e `currentUserId`. Mockar `repository.buscarPorEmail` para retornar um usuário com ID diferente.                                                         | `repository.buscarPorEmail` é chamado. `CustomError` é lançado com `statusCode: HttpStatusCodes.BAD_REQUEST.code`, `field: "email"`.                                                                                                                                                                                        |
| **`UsuarioService.validateCpf` (Auxiliar)** |                                                                                                                          |                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                                                                                             |
| Validar CPF (não em uso)                      | Não deve lançar erro se o CPF não estiver em uso ou pertencer ao `currentUserId`.                                            | Chamar `service.validateCpf` com `cpfNovo` (e opcionalmente `currentUserId`). Mockar `repository.buscarPorCpf` para retornar `null`.                                                                    | `repository.buscarPorCpf` é chamado. Nenhuma exceção é lançada.                                                                                                                                                                                                                                                                             |
| Validar CPF (em uso por outro)                | Deve lançar `CustomError` se o CPF já estiver em uso por um usuário diferente de `currentUserId`.                            | Chamar `service.validateCpf` com `cpfExistente` e `currentUserId`. Mockar `repository.buscarPorCpf` para retornar um usuário com ID diferente.                                                               | `repository.buscarPorCpf` é chamado. `CustomError` é lançado com `statusCode: HttpStatusCodes.BAD_REQUEST.code`, `field: "cpf"`.                                                                                                                                                                                                |
| **`UsuarioService.ensureUserExists` (Auxiliar)**|                                                                                                                          |                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                                                                                             |
| Garantir usuário (existe)                     | Deve retornar o objeto do usuário se ele for encontrado.                                                                   | Chamar `service.ensureUserExists` com `idExistente`. Mockar `repository.buscarPorId` para retornar `mockUser`.                                                                                            | `repository.buscarPorId` é chamado. O método retorna `mockUser`.                                                                                                                                                                                                                                                                    |
| Garantir usuário (não existe)                 | Deve lançar `CustomError` se o usuário não for encontrado.                                                                 | Chamar `service.ensureUserExists` com `idInexistente`. Mockar `repository.buscarPorId` para retornar `null`.                                                                                              | `repository.buscarPorId` é chamado. `CustomError` é lançado com `statusCode: HttpStatusCodes.NOT_FOUND.code` e mensagem `messages.error.resourceNotFound("Usuário")`.                                                                                                                                                              |

# Plano de Teste Repository (Milestone 2 - Sprint 3)

| Funcionalidade                                     | Comportamento Esperado                                                                              | Verificações                                                                                                                                                               | Critérios de Aceite                                                                                                                                                                                                                                |
| :------------------------------------------------- | :-------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Buscar Usuário por ID (Repositório)** |                                                                                                     |                                                                                                                                                                            |                                                                                                                                                                                                                                    |
| Buscar por ID                     | Deve buscar um usuário pelo ID, sem selecionar campos de token.                                       | Chamar `repository.buscarPorId(mockUsuarioId)`. Mockar `UsuarioModel.findById().exec()` para resolver com `mockUsuarioData`.                                               | `UsuarioModel.findById` é chamado com `mockUsuarioId`. `mockSelect` (do mock da query) não é chamado. O método retorna `mockUsuarioData`.                                                                                                 |                                                                                  |
| Buscar por ID (não encontrado)                   | Deve lançar `CustomError` se nenhum usuário for encontrado com o ID fornecido.                        | Chamar `repository.buscarPorId(mockUsuarioId)`. Mockar `UsuarioModel.findById().exec()` para resolver com `null`.                                                          | `UsuarioModel.findById` é chamado. `CustomError` é lançado com `statusCode: 404` e mensagem `messages.error.resourceNotFound("Usuário")`.                                                                                                    |
| **Buscar Usuário por Email (Repositório)** |                                                                                                     |                                                                                                                                                                            |                                                                                                                                                                                                                                    |
| Buscar por Email (encontrado)                    | Deve buscar um usuário pelo email, selecionando o campo `senha`.                                    | Chamar `repository.buscarPorEmail(email)`. Mockar `UsuarioModel.findOne()` para resolver com `mockUsuarioData`.                                                          | `UsuarioModel.findOne` é chamado com `{ email }` e `'+senha'`. O método retorna `mockUsuarioData`.                                                                                                                                                              |
| Buscar por Email (não encontrado)                | Deve retornar `null` se nenhum usuário for encontrado com o email fornecido.                          | Chamar `repository.buscarPorEmail(email)`. Mockar `UsuarioModel.findOne()` para resolver com `null`.                                                                     | `UsuarioModel.findOne` é chamado. O método retorna `null`.                                                                                                                                                                                  |
| **Buscar Usuário por CPF (Repositório)** |                                                                                                     |                                                                                                                                                                            |                                                                                                                                                                                                                                    |
| Buscar por CPF (encontrado)                      | Deve buscar um usuário pelo CPF.                                                                    | Chamar `repository.buscarPorCpf(cpf)`. Mockar `UsuarioModel.findOne()` para resolver com `mockUsuarioData`.                                                              | `UsuarioModel.findOne` é chamado com `{ cpf }`. O método retorna `mockUsuarioData`.                                                                                                                                                               
| Buscar por CPF (não encontrado)                  | Deve retornar `null` se nenhum usuário for encontrado com o CPF fornecido.                            | Chamar `repository.buscarPorCpf(cpf)`. Mockar `UsuarioModel.findOne()` para resolver com `null`.                                                                          | `UsuarioModel.findOne` é chamado. O método retorna `null`.                                                                                                                                                                                  |
| **Listar Usuários (Repositório)** |                                                                                                     |                                                                                                                                                                            |                                                                                                                                                                                                                                    |
| Listar (por ID - encontrado)                     | Se um ID é fornecido nos parâmetros, deve buscar o usuário por ID com `populate` e `lean`.            | Chamar `repository.listar({ params: { id: mockUsuarioId } })`. Mockar `UsuarioModel.findById().populate().lean().exec()` para resolver com `mockUsuarioData`.               | `UsuarioModel.findById` é chamado com `mockUsuarioId`. `mockPopulate` é chamado com `{ path: 'campus', select: 'nome _id' }`. `mockLean` é chamado. O método retorna `mockUsuarioData`.                                               |
| Listar (por ID - não encontrado)                 | Se um ID é fornecido e o usuário não é encontrado, deve lançar `CustomError`.                       | Chamar `repository.listar({ params: { id: mockUsuarioId } })`. Mockar `UsuarioModel.findById().populate().lean().exec()` para resolver com `null`.                    | `UsuarioModel.findById` é chamado. `CustomError` é lançado com `statusCode: 404` e mensagem `messages.error.resourceNotFound("Usuário")`.                                                                                                    |
| Listar (sem ID - com filtros e paginação)        | Se nenhum ID é fornecido, deve construir filtros, aplicar paginação, `populate`, `sort` e `lean`.     | Chamar `repository.listar({ query: { nome, ativo, campus, page, limite } })`. Mockar `UsuarioFilterBuilder` e `UsuarioModel.paginate()`.                                    | `UsuarioFilterBuilder` é instanciado. Métodos `comNome`, `comAtivo`, `comCampus` e `build` são chamados. `UsuarioModel.paginate` é chamado com filtros construídos e opções de paginação corretas (page, limit, populate, sort, lean). Retorna `mockPaginatedData`. |
| Listar (sem ID - filtros e paginação padrão)     | Deve usar valores padrão para filtros e paginação se não fornecidos na query.                       | Chamar `repository.listar({ query: {} })`. Mockar `UsuarioFilterBuilder.build` e `UsuarioModel.paginate()`.                                                              | `UsuarioFilterBuilder` é chamado com valores vazios/padrão. `UsuarioModel.paginate` é chamado com opções de paginação padrão (`page: 1`, `limit: 10`).                                                                                    |
| Listar (sem ID - limite máximo)                  | Deve restringir o parâmetro `limite` da paginação a um máximo de 100.                               | Chamar `repository.listar({ query: { limite: '200' } })`. Mockar `UsuarioModel.paginate()`.                                                                               | `UsuarioModel.paginate` é chamado com `limit: 100`.                                                                                                                                                                                             |
| Listar (sem ID - erro `filterBuilder.build`)     | Deve lançar `CustomError` com status 500 se `filterBuilder.build` não for uma função (guarda interna). | Chamar `repository.listar({ query: {} })`. Mockar `UsuarioFilterBuilder` para que `build` seja `undefined`.                                                              | `CustomError` é lançado com `statusCode: 500` e mensagem `messages.error.internalServerError("Usuário")`.                                                                                                                                 |
| **Criar Usuário (Repositório)** |                                                                                                     |                                                                                                                                                                            |                                                                                                                                                                                                                                    |
| Criar usuário                                    | Deve instanciar `UsuarioModel` com os dados fornecidos e chamar `save()`.                             | Chamar `repository.criar(novoUsuario)`. Mockar construtor `UsuarioModel` e `mockUsuarioSave.mockResolvedValueOnce(usuarioSalvo)`.                                    | `UsuarioModel` é instanciado com `novoUsuario`. `mockUsuarioSave` é chamado. O método retorna `usuarioSalvo`.                                                                                                                             |
| **Atualizar Usuário (Repositório)** |                                                                                                     |                                                                                                                                                                            |                                                                                                                                                                                                                                    |
| Atualizar usuário (encontrado)                   | Deve atualizar um usuário por ID, aplicar `populate`, `lean` e retornar os dados atualizados.         | Chamar `repository.atualizar(mockUsuarioId, dadosAtualizacao)`. Mockar `UsuarioModel.findByIdAndUpdate().populate().lean().exec()` para resolver com `usuarioAtualizado`. | `UsuarioModel.findByIdAndUpdate` é chamado com `mockUsuarioId`, `dadosAtualizacao` e `{ new: true }`. `mockPopulate` e `mockLean` são chamados. O método retorna `usuarioAtualizado`.                                                        |
| Atualizar usuário (não encontrado)               | Deve lançar `CustomError` se o usuário não for encontrado para atualização.                         | Chamar `repository.atualizar(mockUsuarioId, dadosAtualizacao)`. Mockar `UsuarioModel.findByIdAndUpdate().populate().lean().exec()` para resolver com `null`.             | `UsuarioModel.findByIdAndUpdate` é chamado. `CustomError` é lançado com `statusCode: 404` e mensagem `messages.error.resourceNotFound("Usuário")`.                                                                                             |
| **Deletar Usuário (Repositório)** |                                                                                                     |                                                                                                                                                                            |                                                                                                                                                                                                                                    |
| Deletar usuário (existente)                      | Deve deletar um usuário por ID usando `findByIdAndDelete`.                                          | Chamar `repository.deletar(mockUsuarioId)`. Mockar `UsuarioModel.findByIdAndDelete()` para resolver com `mockDeleteResult` (ex: `{ deletedCount: 1 }`).             | `UsuarioModel.findByIdAndDelete` é chamado com `mockUsuarioId`. O método retorna `mockDeleteResult`.                                                                                                                                    |
| Deletar usuário (não existente)                  | Deve retornar o resultado de `findByIdAndDelete` (ex: `null`) mesmo que o usuário não exista.       | Chamar `repository.deletar('idInexistente')`. Mockar `UsuarioModel.findByIdAndDelete()` para resolver com `null`.                                                        | `UsuarioModel.findByIdAndDelete` é chamado com `'idInexistente'`. O método retorna `null`.                                                                                                                                               |

# Plano de Teste ENDPOINT (Sprint X)

*(A ser preenchido)*
